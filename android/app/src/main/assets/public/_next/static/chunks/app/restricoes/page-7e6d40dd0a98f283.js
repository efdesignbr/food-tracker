(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[378],{26818:function(e,t,o){Promise.resolve().then(o.bind(o,50634))},50634:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return d}});var r=o(57437),n=o(2265),l=o(16463),a=o(45591);let i={allergy:{label:"Alergias",icon:"alert-triangle",color:"#ef4444"},intolerance:{label:"Intolerancias",icon:"ban",color:"#f59e0b"},diet:{label:"Dietas",icon:"salad",color:"#10b981"},religious:{label:"Religiosas",icon:"heart",color:"#6366f1"},medical:{label:"Medicas",icon:"pill",color:"#ec4899"},preference:{label:"Preferencias",icon:"thumbs-up",color:"#8b5cf6"}},s={allergy:[{value:"gluten",label:"Gluten"},{value:"lactose",label:"Lactose"},{value:"peanut",label:"Amendoim"},{value:"tree_nuts",label:"Castanhas/Nozes"},{value:"shellfish",label:"Frutos do Mar"},{value:"fish",label:"Peixes"},{value:"egg",label:"Ovo"},{value:"soy",label:"Soja"},{value:"wheat",label:"Trigo"},{value:"sesame",label:"Gergelim"}],intolerance:[{value:"lactose",label:"Lactose"},{value:"fructose",label:"Frutose"},{value:"histamine",label:"Histamina"},{value:"fodmap",label:"FODMAPs"}],diet:[{value:"vegetarian",label:"Vegetariano"},{value:"vegan",label:"Vegano"},{value:"pescatarian",label:"Pescatariano"},{value:"low_carb",label:"Low Carb"},{value:"keto",label:"Cetogenica"},{value:"paleo",label:"Paleo"},{value:"mediterranean",label:"Mediterranea"}],religious:[{value:"halal",label:"Halal"},{value:"kosher",label:"Kosher"},{value:"no_pork",label:"Sem Carne de Porco"},{value:"no_beef",label:"Sem Carne Bovina"}],medical:[{value:"diabetes",label:"Diabetes"},{value:"hypertension",label:"Hipertensao"},{value:"celiac",label:"Doenca Celiaca"},{value:"phenylketonuria",label:"Fenilcetonuria"},{value:"gout",label:"Gota"},{value:"kidney_disease",label:"Doenca Renal"}],preference:[{value:"no_sugar",label:"Sem Acucar Refinado"},{value:"organic_only",label:"Apenas Organicos"},{value:"no_processed",label:"Sem Ultraprocessados"}]},c=[{value:"mild",label:"Leve",color:"#fef3c7"},{value:"moderate",label:"Moderada",color:"#fed7aa"},{value:"severe",label:"Grave",color:"#fecaca"}];function d(){let e=(0,l.useRouter)(),[t,o]=(0,n.useState)(!0),[d,u]=(0,n.useState)(!1),[f,p]=(0,n.useState)([]),[h,g]=(0,n.useState)("allergy"),[b,y]=(0,n.useState)(null),[v,m]=(0,n.useState)(!1),[x,j]=(0,n.useState)(""),[w,S]=(0,n.useState)("moderate"),[k,C]=(0,n.useState)(!1),[z,_]=(0,n.useState)(null),[T,R]=(0,n.useState)("moderate");async function A(){try{o(!0);let e=await a.h.get("/api/dietary-restrictions"),t=await e.json();e.ok&&p(t.restrictions||[])}catch(e){console.error("Erro ao buscar restricoes:",e)}finally{o(!1)}}async function W(e,t){try{u(!0),(await a.h.post("/api/dietary-restrictions",{restriction_type:h,restriction_value:e,severity:t||("allergy"===h?"moderate":void 0)})).ok&&await A()}catch(e){console.error("Erro ao adicionar restricao:",e)}finally{u(!1)}}async function E(e){try{u(!0),(await a.h.delete("/api/dietary-restrictions?id=".concat(e))).ok&&p(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Erro ao remover restricao:",e)}finally{u(!1)}}async function I(){if(z)try{u(!0),(await a.h.patch("/api/dietary-restrictions",{id:z.id,severity:T})).ok&&(await A(),C(!1),_(null))}catch(e){console.error("Erro ao atualizar severidade:",e)}finally{u(!1)}}function P(e){return f.some(t=>t.restriction_type===h&&t.restriction_value===e)}function B(e){if(P(e)){let t=function(e){let t=f.find(t=>t.restriction_type===h&&t.restriction_value===e);return null==t?void 0:t.id}(e);t&&E(t)}else W(e)}(0,n.useEffect)(()=>{A()},[]);let L=f.filter(e=>e.restriction_type===h),O=s[h]||[],D=L.filter(e=>!O.some(t=>t.value===e.restriction_value)),N=i[h];return t?(0,r.jsx)("div",{style:{padding:24,maxWidth:800,margin:"0 auto"},children:(0,r.jsx)("div",{style:{textAlign:"center",padding:48},children:(0,r.jsx)("p",{style:{color:"#666",fontSize:16},children:"Carregando..."})})}):(0,r.jsxs)("div",{style:{padding:16,maxWidth:800,margin:"0 auto",paddingBottom:80},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[(0,r.jsx)("button",{onClick:()=>e.back(),style:{padding:"8px 16px",background:"#f3f4f6",border:"none",borderRadius:8,cursor:"pointer",fontSize:14,fontWeight:600},children:"Voltar"}),(0,r.jsx)("h1",{style:{fontSize:24,fontWeight:700,flex:1},children:"Restricoes Alimentares"})]}),(0,r.jsx)("div",{style:{padding:16,background:"#f0f9ff",borderRadius:12,marginBottom:24,fontSize:14,color:"#0369a1"},children:"Configure suas restricoes alimentares para receber recomendacoes personalizadas do Coach IA."}),(0,r.jsx)("div",{style:{display:"flex",gap:8,overflowX:"auto",paddingBottom:8,marginBottom:24,WebkitOverflowScrolling:"touch"},children:Object.keys(i).map(e=>{let t=i[e],o=f.filter(t=>t.restriction_type===e).length,n=h===e;return(0,r.jsxs)("button",{onClick:()=>g(e),style:{padding:"10px 16px",background:n?t.color:"#f3f4f6",color:n?"white":"#374151",border:"none",borderRadius:8,cursor:"pointer",fontSize:13,fontWeight:600,whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:6},children:[t.label,o>0&&(0,r.jsx)("span",{style:{background:n?"rgba(255,255,255,0.3)":t.color,color:"white",padding:"2px 6px",borderRadius:10,fontSize:11,fontWeight:700},children:o})]},e)})}),(0,r.jsxs)("div",{style:{background:"white",borderRadius:16,padding:20,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[(0,r.jsx)("h2",{style:{fontSize:18,fontWeight:700,marginBottom:16,color:N.color},children:N.label}),(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:20},children:O.map(e=>{var t;let o=P(e.value),n=(t=e.value,f.find(e=>e.restriction_type===h&&e.restriction_value===t)),l=n?c.find(e=>e.value===n.severity):null,a="allergy"===h;return o&&a?(0,r.jsxs)("div",{style:{display:"flex",alignItems:"stretch",background:N.color,borderRadius:12,overflow:"hidden"},children:[(0,r.jsxs)("button",{onClick:()=>n&&void(_(n),R(n.severity),C(!0)),disabled:d,style:{padding:"8px 12px",background:"transparent",border:"none",cursor:d?"not-allowed":"pointer",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:2},children:[(0,r.jsx)("span",{style:{fontSize:14,fontWeight:600,color:"white"},children:e.label}),(0,r.jsxs)("span",{style:{fontSize:11,color:"rgba(255,255,255,0.9)",display:"flex",alignItems:"center",gap:4},children:[(0,r.jsx)("span",{style:{width:6,height:6,borderRadius:"50%",background:(null==l?void 0:l.color)||"#fed7aa"}}),(null==l?void 0:l.label)||"Moderada"]})]}),(0,r.jsx)("button",{onClick:()=>B(e.value),disabled:d,style:{padding:"0 12px",background:"rgba(0,0,0,0.1)",border:"none",borderLeft:"1px solid rgba(255,255,255,0.2)",cursor:d?"not-allowed":"pointer",color:"white",fontSize:16,display:"flex",alignItems:"center"},children:"x"})]},e.value):(0,r.jsxs)("button",{onClick:()=>B(e.value),disabled:d,style:{padding:"10px 16px",background:o?N.color:"#f3f4f6",color:o?"white":"#374151",border:o?"none":"2px solid #e5e7eb",borderRadius:20,cursor:d?"not-allowed":"pointer",fontSize:14,fontWeight:600,display:"flex",alignItems:"center",gap:6,opacity:d?.7:1},children:[e.label,o&&(0,r.jsx)("span",{style:{fontSize:12},children:"x"})]},e.value)})}),D.length>0&&(0,r.jsxs)("div",{style:{marginBottom:20},children:[(0,r.jsx)("h3",{style:{fontSize:14,fontWeight:600,color:"#6b7280",marginBottom:8},children:"Personalizadas"}),(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:D.map(e=>(0,r.jsxs)("button",{onClick:()=>E(e.id),disabled:d,style:{padding:"10px 16px",background:N.color,color:"white",border:"none",borderRadius:20,cursor:d?"not-allowed":"pointer",fontSize:14,fontWeight:600,display:"flex",alignItems:"center",gap:6,textTransform:"capitalize"},children:[e.restriction_value.replace(/_/g," "),(0,r.jsx)("span",{style:{fontSize:12},children:"x"})]},e.id))})]}),(0,r.jsxs)("button",{onClick:()=>m(!0),style:{width:"100%",padding:14,background:"#f3f4f6",border:"2px dashed #d1d5db",borderRadius:12,cursor:"pointer",fontSize:14,fontWeight:600,color:"#6b7280"},children:["+ Adicionar ",N.label.toLowerCase().slice(0,-1)," personalizada"]})]}),f.length>0&&(0,r.jsxs)("div",{style:{marginTop:24,padding:16,background:"#f0fdf4",borderRadius:12},children:[(0,r.jsx)("h3",{style:{fontSize:14,fontWeight:600,color:"#166534",marginBottom:8},children:"Resumo das suas restricoes"}),(0,r.jsx)("div",{style:{fontSize:13,color:"#166534"},children:Object.keys(i).map(e=>{let t=f.filter(t=>t.restriction_type===e).length;return 0===t?null:(0,r.jsxs)("div",{style:{marginBottom:4},children:[(0,r.jsxs)("strong",{children:[i[e].label,":"]})," ",t]},e)})})]}),v&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:24,zIndex:1e3},children:(0,r.jsxs)("div",{style:{background:"white",borderRadius:16,padding:24,width:"100%",maxWidth:400},children:[(0,r.jsxs)("h2",{style:{fontSize:20,fontWeight:700,marginBottom:16},children:["Adicionar ",N.label.slice(0,-1)]}),(0,r.jsxs)("form",{onSubmit:function(e){e.preventDefault(),x.trim()&&(W(x.trim().toLowerCase(),w),m(!1),j(""),S("moderate"))},children:[(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:8,fontWeight:600},children:"Nome *"}),(0,r.jsx)("input",{type:"text",value:x,onChange:e=>j(e.target.value),placeholder:"Ex: ".concat("allergy"===h?"Kiwi":"diet"===h?"Flexitariano":"Outro"),required:!0,style:{width:"100%",padding:12,fontSize:16,border:"2px solid #e5e7eb",borderRadius:8,boxSizing:"border-box"}})]}),"allergy"===h&&(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:8,fontWeight:600},children:"Severidade"}),(0,r.jsx)("div",{style:{display:"flex",gap:8},children:c.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>S(e.value),style:{flex:1,padding:10,background:w===e.value?e.color:"#f3f4f6",border:w===e.value?"2px solid ".concat(N.color):"2px solid transparent",borderRadius:8,cursor:"pointer",fontSize:14,fontWeight:600,color:"#374151"},children:e.label},e.value))})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,r.jsx)("button",{type:"button",onClick:()=>{m(!1),j("")},style:{flex:1,padding:12,background:"#f3f4f6",border:"none",borderRadius:8,cursor:"pointer",fontSize:16,fontWeight:600},children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",disabled:d,style:{flex:1,padding:12,background:N.color,color:"white",border:"none",borderRadius:8,cursor:d?"not-allowed":"pointer",fontSize:16,fontWeight:600},children:"Adicionar"})]})]})]})}),k&&z&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:24,zIndex:1e3},children:(0,r.jsxs)("div",{style:{background:"white",borderRadius:16,padding:24,width:"100%",maxWidth:400},children:[(0,r.jsx)("h2",{style:{fontSize:20,fontWeight:700,marginBottom:8},children:"Severidade da Alergia"}),(0,r.jsx)("p",{style:{fontSize:14,color:"#6b7280",marginBottom:16},children:z.restriction_value.charAt(0).toUpperCase()+z.restriction_value.slice(1).replace(/_/g," ")}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8,marginBottom:20},children:c.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>R(e.value),style:{padding:14,background:T===e.value?e.color:"#f3f4f6",border:T===e.value?"2px solid ".concat(N.color):"2px solid transparent",borderRadius:8,cursor:"pointer",fontSize:14,fontWeight:600,color:"#374151",textAlign:"left"},children:[(0,r.jsx)("strong",{children:e.label}),(0,r.jsxs)("span",{style:{display:"block",fontSize:12,color:"#6b7280",marginTop:4},children:["mild"===e.value&&"Desconforto leve, pode consumir em pequenas quantidades","moderate"===e.value&&"Reacao moderada, evitar consumo","severe"===e.value&&"Risco de anafilaxia, evitar completamente"]})]},e.value))}),(0,r.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,r.jsx)("button",{type:"button",onClick:()=>{C(!1),_(null)},style:{flex:1,padding:12,background:"#f3f4f6",border:"none",borderRadius:8,cursor:"pointer",fontSize:16,fontWeight:600},children:"Cancelar"}),(0,r.jsx)("button",{type:"button",onClick:I,disabled:d,style:{flex:1,padding:12,background:N.color,color:"white",border:"none",borderRadius:8,cursor:d?"not-allowed":"pointer",fontSize:16,fontWeight:600},children:"Salvar"})]})]})})]})}},45591:function(e,t,o){"use strict";o.d(t,{h:function(){return a},x:function(){return l}});var r=o(45800);let n=o(20357).env.NEXT_PUBLIC_API_URL||"https://app.foodtracker.com.br";async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{token:o,timeoutMs:l,...a}=t,i={...a.headers};if(o)i.Authorization="Bearer ".concat(o);else{let e=localStorage.getItem("auth_token");console.log("[API Client] localStorage auth_token:",e?"exists":"null"),e&&(i.Authorization="Bearer ".concat(e))}a.body&&"string"==typeof a.body&&!i["Content-Type"]&&(i["Content-Type"]="application/json");let s=e.startsWith("http")?e:"".concat(n).concat(e);console.log("[API Client]",{isMobile:!0,baseUrl:n,endpoint:e,finalUrl:s,hasAuthToken:!!i.Authorization,allHeaders:Object.keys(i),xAdCompleted:i["x-ad-completed"]||"not set"});try{var c;let t=a.signal?null:new AbortController,o=null!==(c=null==t?void 0:t.signal)&&void 0!==c?c:a.signal,n=null;t&&(n=setTimeout(()=>{try{t.abort()}catch(e){}},"number"==typeof l?l:1e4));let d=await fetch(s,{...a,headers:i,credentials:"include",signal:o});if(n&&clearTimeout(n),console.log("[API Client] Response ".concat(e,":"),{status:d.status}),401===d.status){console.warn("401 Unauthorized - triggering client logout");try{(0,r.h)()}catch(e){}}if(404===d.status)try{let e=d.clone(),t=await e.json().catch(()=>null),o=(null==t?void 0:t.error)||"";if("string"==typeof o&&o.toLowerCase().includes("tenant")){console.warn("404 tenant_not_found - triggering client logout");try{(0,r.h)()}catch(e){}}}catch(e){}return d}catch(e){if((null==e?void 0:e.name)==="AbortError")throw console.error("[API Client Error] Timeout"),Error("Tempo de rede esgotado");throw console.error("[API Client Error]",e),e}}let a={get:(e,t)=>l(e,{method:"GET",token:t}),post:(e,t,o)=>l(e,{method:"POST",body:JSON.stringify(t),token:o}),put:(e,t,o)=>l(e,{method:"PUT",body:JSON.stringify(t),token:o}),patch:(e,t,o)=>l(e,{method:"PATCH",body:JSON.stringify(t),token:o}),delete:(e,t)=>l(e,{method:"DELETE",token:t})}},45800:function(e,t,o){"use strict";function r(){try{try{localStorage.removeItem("auth_token")}catch(e){}try{localStorage.setItem("auth_logout_at",String(Date.now()))}catch(e){}try{window.dispatchEvent(new Event("app:logout"))}catch(e){}}catch(e){}}o.d(t,{h:function(){return r}})},16463:function(e,t,o){"use strict";var r=o(71169);o.o(r,"usePathname")&&o.d(t,{usePathname:function(){return r.usePathname}}),o.o(r,"useRouter")&&o.d(t,{useRouter:function(){return r.useRouter}}),o.o(r,"useSearchParams")&&o.d(t,{useSearchParams:function(){return r.useSearchParams}})},20357:function(e,t,o){"use strict";var r,n;e.exports=(null==(r=o.g.process)?void 0:r.env)&&"object"==typeof(null==(n=o.g.process)?void 0:n.env)?o.g.process:o(88081)},88081:function(e){!function(){var t={229:function(e){var t,o,r,n=e.exports={};function l(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(o){try{return t.call(null,e,0)}catch(o){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var s=[],c=!1,d=-1;function u(){c&&r&&(c=!1,r.length?s=r.concat(s):d=-1,s.length&&f())}function f(){if(!c){var e=i(u);c=!0;for(var t=s.length;t;){for(r=s,s=[];++d<t;)r&&r[d].run();d=-1,t=s.length}r=null,c=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function h(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];s.push(new p(e,t)),1!==s.length||c||i(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=h,n.addListener=h,n.once=h,n.off=h,n.removeListener=h,n.removeAllListeners=h,n.emit=h,n.prependListener=h,n.prependOnceListener=h,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},o={};function r(e){var n=o[e];if(void 0!==n)return n.exports;var l=o[e]={exports:{}},a=!0;try{t[e](l,l.exports,r),a=!1}finally{a&&delete o[e]}return l.exports}r.ab="//";var n=r(229);e.exports=n}()}},function(e){e.O(0,[971,23,744],function(){return e(e.s=26818)}),_N_E=e.O()}]);