(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[573],{39919:function(e,t,r){Promise.resolve().then(r.bind(r,70526))},70526:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var o=r(57437),n=r(2265),i=r(45591),a=r(16463),s=r(86856),l=r(25974),c=r(54142),d=r(2842),h=r(9542),p=r(60560),u=r(82684),g=r(7948),f=r(81),y=r(68295),x=r(34015),m=r(92566),b=r(71534);let j=["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6","#ec4899","#6366f1","#14b8a6"],S=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"];function v(){let e=(0,a.useRouter)(),[t,r]=(0,n.useState)(null),[m,b]=(0,n.useState)(!0),[S,v]=(0,n.useState)(null);async function k(){try{b(!0);let e=await i.h.get("/api/shopping-lists/stats"),t=await e.json();e.ok?r(t.stats):v(t.error||"Erro ao carregar dados")}catch(e){v(e.message||"Erro de conex\xe3o")}finally{b(!1)}}function C(e){return e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function B(e){let[t,r]=e.split("-");return new Date(parseInt(t),parseInt(r)-1,1).toLocaleDateString("pt-BR",{month:"short",year:"2-digit"})}return((0,n.useEffect)(()=>{k()},[]),m)?(0,o.jsx)("div",{style:{padding:32,textAlign:"center",color:"#6b7280"},children:"Carregando estat\xedsticas..."}):S?(0,o.jsxs)("div",{style:{padding:32,textAlign:"center",color:"#ef4444"},children:["Erro: ",S,(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:k,style:{marginTop:16,padding:"8px 16px",background:"#f3f4f6",border:"none",borderRadius:8,cursor:"pointer"},children:"Tentar novamente"})]}):t?(0,o.jsxs)("div",{style:{maxWidth:1e3,margin:"0 auto",padding:24,paddingBottom:80},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:32},children:[(0,o.jsx)("button",{onClick:()=>e.back(),style:{padding:"8px 16px",background:"#f3f4f6",border:"none",borderRadius:8,cursor:"pointer",fontSize:14,fontWeight:600,color:"#374151"},children:"← Voltar"}),(0,o.jsx)("h1",{style:{fontSize:28,fontWeight:700,margin:0},children:"Painel de Gastos"})]}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:24},children:[(0,o.jsxs)("div",{style:{background:"white",borderRadius:16,padding:24,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",gridColumn:"1 / -1"},children:[(0,o.jsx)("h2",{style:{fontSize:18,fontWeight:600,marginBottom:24,color:"#1f2937"},children:"Evolu\xe7\xe3o de Gastos (\xdaltimos 12 meses)"}),(0,o.jsx)("div",{style:{height:300,width:"100%"},children:t.monthly.length>0?(0,o.jsx)(s.h,{width:"100%",height:"100%",children:(0,o.jsxs)(l.v,{data:t.monthly,children:[(0,o.jsx)(c.q,{strokeDasharray:"3 3",vertical:!1,stroke:"#e5e7eb"}),(0,o.jsx)(d.K,{dataKey:"month",tickFormatter:B,axisLine:!1,tickLine:!1,tick:{fill:"#6b7280",fontSize:12},dy:10}),(0,o.jsx)(h.B,{axisLine:!1,tickLine:!1,tick:{fill:"#6b7280",fontSize:12},tickFormatter:e=>"R$".concat(e)}),(0,o.jsx)(p.u,{cursor:{fill:"#f3f4f6"},formatter:e=>[C(Number(e)),"Total"],labelFormatter:e=>B(e),contentStyle:{borderRadius:8,border:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),(0,o.jsx)(u.$Q,{dataKey:"total",fill:"#10b981",radius:[4,4,0,0],maxBarSize:60})]})}):(0,o.jsx)("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af"},children:"Sem dados suficientes"})})]}),(0,o.jsxs)("div",{style:{background:"white",borderRadius:16,padding:24,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[(0,o.jsx)("h2",{style:{fontSize:18,fontWeight:600,marginBottom:24,color:"#1f2937"},children:"Onde voc\xea compra"}),(0,o.jsx)("div",{style:{height:300,width:"100%"},children:t.byStore.length>0?(0,o.jsx)(s.h,{width:"100%",height:"100%",children:(0,o.jsxs)(g.u,{children:[(0,o.jsx)(f.by,{data:t.byStore,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"total",nameKey:"storeName",children:t.byStore.map((e,t)=>(0,o.jsx)(y.b,{fill:j[t%j.length]},"cell-".concat(t)))}),(0,o.jsx)(p.u,{formatter:(e,t)=>[C(Number(e)),t],contentStyle:{borderRadius:8,border:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),(0,o.jsx)(x.D,{layout:"horizontal",verticalAlign:"bottom",align:"center",wrapperStyle:{fontSize:12,paddingTop:20}})]})}):(0,o.jsx)("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af"},children:"Sem dados suficientes"})})]}),(0,o.jsx)(w,{})]})]}):null}function w(){let[e,t]=(0,n.useState)([]),[r,a]=(0,n.useState)(null),[l,u]=(0,n.useState)(null),[g,f]=(0,n.useState)("all"),[y,x]=(0,n.useState)(!0),[j,v]=(0,n.useState)(!1),[w,k]=(0,n.useState)(""),C=(0,n.useRef)(null);async function B(){try{x(!0);let e=await i.h.get("/api/shopping-lists/price-analysis"),r=await e.json();e.ok&&r.analysis&&t(r.analysis.products||[])}catch(e){console.error("Erro ao carregar produtos:",e)}finally{x(!1)}}async function R(e){try{v(!0);let t=await i.h.get("/api/shopping-lists/price-analysis?product=".concat(encodeURIComponent(e))),r=await t.json();t.ok&&r.analysis&&u({pricesByStore:r.analysis.pricesByStore||[],priceHistory:r.analysis.priceHistory||[]})}catch(e){console.error("Erro ao carregar an\xe1lise:",e)}finally{v(!1)}}function z(e){return e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function A(e){return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}(0,n.useEffect)(()=>{B()},[]);let N=e.filter(e=>e.displayName.toLowerCase().includes(w.toLowerCase())),{data:E,stores:T}=(()=>{if(!l)return{data:[],stores:[]};let e=l.priceHistory,t=[...new Set(e.map(e=>e.storeName))].slice(0,5);if("all"!==g)return{data:e.filter(e=>e.storeName===g).map(e=>({date:e.date,price:e.price})),stores:[g]};let r=new Map;return e.forEach(e=>{if(!t.includes(e.storeName))return;let o=e.date;r.has(o)||r.set(o,{date:o}),r.get(o)[e.storeName]=e.price}),{data:Array.from(r.values()),stores:t}})(),I=(()=>{if(!l||l.pricesByStore.length<2)return null;let e=l.pricesByStore[0],t=l.pricesByStore[l.pricesByStore.length-1];return{store:e.storeName,amount:t.lastPrice-e.lastPrice}})();return(0,o.jsxs)("div",{ref:C,style:{background:"white",borderRadius:16,padding:20,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",gridColumn:"1 / -1"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[r&&(0,o.jsx)("button",{onClick:function(){a(null),u(null),k("")},style:{padding:"8px 12px",background:"#f3f4f6",border:"none",borderRadius:8,cursor:"pointer",fontSize:14,fontWeight:600,color:"#374151"},children:"←"}),(0,o.jsx)("h2",{style:{fontSize:18,fontWeight:600,color:"#1f2937",margin:0},children:r?r.charAt(0).toUpperCase()+r.slice(1):"An\xe1lise de Pre\xe7os"})]}),y?(0,o.jsx)("div",{style:{padding:40,textAlign:"center",color:"#6b7280"},children:"Carregando..."}):r?j?(0,o.jsx)("div",{style:{padding:40,textAlign:"center",color:"#6b7280"},children:"Carregando an\xe1lise..."}):l?(0,o.jsxs)("div",{children:[l.pricesByStore.length>0&&(0,o.jsxs)("div",{style:{marginBottom:24},children:[(0,o.jsx)("h3",{style:{fontSize:14,fontWeight:600,color:"#6b7280",marginBottom:16,textTransform:"uppercase",letterSpacing:.5},children:"Onde est\xe1 mais barato"}),(0,o.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:l.pricesByStore.map((e,t)=>{let r=l.pricesByStore[l.pricesByStore.length-1].lastPrice,n=e.lastPrice/r*100,i=0===t;return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[(0,o.jsx)("span",{style:{fontSize:14,fontWeight:500,color:"#374151"},children:e.storeName}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,o.jsx)("span",{style:{fontSize:15,fontWeight:600,color:i?"#059669":"#374151"},children:z(e.lastPrice)}),i&&(0,o.jsx)("span",{style:{background:"#d1fae5",color:"#059669",padding:"2px 8px",borderRadius:12,fontSize:11,fontWeight:600},children:"menor"})]})]}),(0,o.jsx)("div",{style:{width:"100%",height:8,backgroundColor:"#f3f4f6",borderRadius:4,overflow:"hidden"},children:(0,o.jsx)("div",{style:{width:"".concat(n,"%"),height:"100%",backgroundColor:i?"#10b981":"#d1d5db",borderRadius:4,transition:"width 0.3s ease"}})})]},e.storeName)})}),I&&I.amount>0&&(0,o.jsxs)("div",{style:{marginTop:16,padding:12,background:"#fef3c7",borderRadius:10,display:"flex",alignItems:"center",gap:8},children:[(0,o.jsx)("span",{style:{fontSize:18},children:"\uD83D\uDCA1"}),(0,o.jsxs)("span",{style:{fontSize:13,color:"#92400e"},children:["Voc\xea economiza ",(0,o.jsx)("strong",{children:z(I.amount)})," comprando no ",I.store]})]})]}),l.priceHistory.length>1&&(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,o.jsx)("h3",{style:{fontSize:14,fontWeight:600,color:"#6b7280",margin:0,textTransform:"uppercase",letterSpacing:.5},children:"Evolu\xe7\xe3o do pre\xe7o"}),T.length>1&&(0,o.jsxs)("select",{value:g,onChange:e=>f(e.target.value),style:{padding:"6px 10px",border:"1px solid #e5e7eb",borderRadius:8,fontSize:13,fontFamily:"inherit",background:"white",color:"#374151"},children:[(0,o.jsx)("option",{value:"all",children:"Todos"}),[...new Set(l.priceHistory.map(e=>e.storeName))].slice(0,5).map(e=>(0,o.jsx)("option",{value:e,children:e},e))]})]}),(0,o.jsx)("div",{style:{height:200,width:"100%"},children:(0,o.jsx)(s.h,{width:"100%",height:"100%",children:(0,o.jsxs)(m.w,{data:E,children:[(0,o.jsx)(c.q,{strokeDasharray:"3 3",vertical:!1,stroke:"#e5e7eb"}),(0,o.jsx)(d.K,{dataKey:"date",tickFormatter:A,axisLine:!1,tickLine:!1,tick:{fill:"#6b7280",fontSize:11},dy:8}),(0,o.jsx)(h.B,{axisLine:!1,tickLine:!1,tick:{fill:"#6b7280",fontSize:11},tickFormatter:e=>"R$".concat(e),width:50}),(0,o.jsx)(p.u,{labelFormatter:e=>A(e),formatter:(e,t)=>[z(Number(e)),"all"===g&&t||"Pre\xe7o"],contentStyle:{borderRadius:8,border:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:13}}),"all"===g?T.map((e,t)=>(0,o.jsx)(b.x1,{type:"monotone",dataKey:e,name:e,stroke:S[t%S.length],strokeWidth:2.5,dot:{r:5,strokeWidth:2},activeDot:{r:7},connectNulls:!0},e)):(0,o.jsx)(b.x1,{type:"monotone",dataKey:"price",stroke:S[0],strokeWidth:2.5,dot:{r:5,strokeWidth:2},activeDot:{r:7},connectNulls:!0})]})})}),"all"===g&&T.length>1&&(0,o.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:12,marginTop:12,justifyContent:"center"},children:T.map((e,t)=>(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,o.jsx)("div",{style:{width:10,height:10,borderRadius:"50%",backgroundColor:S[t%S.length]}}),(0,o.jsx)("span",{style:{fontSize:12,color:"#6b7280"},children:e})]},e))})]}),1===l.priceHistory.length&&(0,o.jsx)("div",{style:{padding:20,background:"#f9fafb",borderRadius:10,textAlign:"center",color:"#6b7280"},children:(0,o.jsx)("p",{style:{fontSize:13},children:"Apenas 1 registro de pre\xe7o. O gr\xe1fico de evolu\xe7\xe3o aparecer\xe1 ap\xf3s mais compras."})}),0===l.pricesByStore.length&&0===l.priceHistory.length&&(0,o.jsx)("div",{style:{padding:40,textAlign:"center",color:"#9ca3af"},children:(0,o.jsx)("p",{children:"Nenhum dado encontrado para este produto."})})]}):null:(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{type:"text",value:w,onChange:e=>k(e.target.value),placeholder:"Buscar produto...",style:{width:"100%",padding:12,border:"1px solid #e5e7eb",borderRadius:10,fontSize:16,marginBottom:16,fontFamily:"inherit"}}),e.length>0?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{style:{fontSize:13,color:"#6b7280",marginBottom:12},children:w?"Resultados:":"Mais comprados:"}),(0,o.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:N.slice(0,15).map(e=>(0,o.jsx)("button",{onClick:()=>{var t;a(t=e.name),f("all"),R(t),setTimeout(()=>{var e;null===(e=C.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start"})},100)},style:{padding:"10px 16px",background:"#f3f4f6",border:"1px solid #e5e7eb",borderRadius:20,fontSize:14,cursor:"pointer",transition:"all 0.2s",fontFamily:"inherit",whiteSpace:"nowrap"},children:e.displayName},e.name))}),0===N.length&&w&&(0,o.jsx)("p",{style:{color:"#9ca3af",textAlign:"center",padding:20},children:"Nenhum produto encontrado"})]}):(0,o.jsxs)("div",{style:{textAlign:"center",padding:40,color:"#9ca3af"},children:[(0,o.jsx)("p",{style:{marginBottom:8,fontWeight:500},children:"Sem dados de pre\xe7os"}),(0,o.jsxs)("p",{style:{fontSize:13},children:["Registre compras com ",(0,o.jsx)("strong",{children:"pre\xe7o unit\xe1rio"})," para ver a an\xe1lise."]})]})]})]})}},45591:function(e,t,r){"use strict";r.d(t,{h:function(){return a},x:function(){return i}});var o=r(45800);let n=r(20357).env.NEXT_PUBLIC_API_URL||"https://app.foodtracker.com.br";async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{token:r,timeoutMs:i,...a}=t,s={...a.headers};if(r)s.Authorization="Bearer ".concat(r);else{let e=localStorage.getItem("auth_token");console.log("[API Client] localStorage auth_token:",e?"exists":"null"),e&&(s.Authorization="Bearer ".concat(e))}a.body&&"string"==typeof a.body&&!s["Content-Type"]&&(s["Content-Type"]="application/json");let l=e.startsWith("http")?e:"".concat(n).concat(e);console.log("[API Client]",{isMobile:!0,baseUrl:n,endpoint:e,finalUrl:l,hasAuthToken:!!s.Authorization,allHeaders:Object.keys(s),xAdCompleted:s["x-ad-completed"]||"not set"});try{var c;let t=a.signal?null:new AbortController,r=null!==(c=null==t?void 0:t.signal)&&void 0!==c?c:a.signal,n=null;t&&(n=setTimeout(()=>{try{t.abort()}catch(e){}},"number"==typeof i?i:1e4));let d=await fetch(l,{...a,headers:s,credentials:"include",signal:r});if(n&&clearTimeout(n),console.log("[API Client] Response ".concat(e,":"),{status:d.status}),401===d.status){console.warn("401 Unauthorized - triggering client logout");try{(0,o.h)()}catch(e){}}if(404===d.status)try{let e=d.clone(),t=await e.json().catch(()=>null),r=(null==t?void 0:t.error)||"";if("string"==typeof r&&r.toLowerCase().includes("tenant")){console.warn("404 tenant_not_found - triggering client logout");try{(0,o.h)()}catch(e){}}}catch(e){}return d}catch(e){if((null==e?void 0:e.name)==="AbortError")throw console.error("[API Client Error] Timeout"),Error("Tempo de rede esgotado");throw console.error("[API Client Error]",e),e}}let a={get:(e,t)=>i(e,{method:"GET",token:t}),post:(e,t,r)=>i(e,{method:"POST",body:JSON.stringify(t),token:r}),put:(e,t,r)=>i(e,{method:"PUT",body:JSON.stringify(t),token:r}),patch:(e,t,r)=>i(e,{method:"PATCH",body:JSON.stringify(t),token:r}),delete:(e,t)=>i(e,{method:"DELETE",token:t})}},45800:function(e,t,r){"use strict";function o(){try{try{localStorage.removeItem("auth_token")}catch(e){}try{localStorage.setItem("auth_logout_at",String(Date.now()))}catch(e){}try{window.dispatchEvent(new Event("app:logout"))}catch(e){}}catch(e){}}r.d(t,{h:function(){return o}})}},function(e){e.O(0,[723,971,23,744],function(){return e(e.s=39919)}),_N_E=e.O()}]);