(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185,398],{65695:function(e,t,n){Promise.resolve().then(n.bind(n,47847)),Promise.resolve().then(n.t.bind(n,76830,23)),Promise.resolve().then(n.t.bind(n,58877,23))},47847:function(e,t,n){"use strict";n.d(t,{default:function(){return m}});var o=n(57437),a=n(2265),r=n(16463),i=n(98174),l=n(87138),s=n(86394),c=n(45800),u=n(87185);let d=[{href:"/",label:"In\xedcio",icon:""},{href:"/capture",label:"Capturar",icon:""},{href:"/history",label:"Hist\xf3rico",icon:""},{href:"/peso",label:"Peso",icon:""},{href:"/lista-compras",label:"Lista de Compras",icon:""},{href:"/coach",label:"Coach IA",icon:""},{href:"/reports",label:"Relat\xf3rios",icon:""},{href:"/restaurants",label:"Restaurantes",icon:""},{href:"/meus-alimentos",label:"Meus Alimentos",icon:""},{href:"/account",label:"Minha Conta",icon:""}];function h(e){let{children:t,tenantName:n,userName:h}=e,f=(0,r.useRouter)(),p=(0,r.usePathname)(),[g,m]=(0,a.useState)(!1),{plan:y,isLoading:v}=(0,s.R)();async function w(){if(localStorage.getItem("auth_token"))try{(0,c.h)()}catch(e){}try{await (0,i.w7)({redirect:!1})}catch(e){console.error("SignOut error:",e)}f.push("/login"),f.refresh()}let[_,b]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{b(u.dV.isNativePlatform())},[]),(0,o.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5"},children:[_&&(0,o.jsx)("div",{style:{height:60,background:"transparent"}}),(0,o.jsxs)("header",{style:{backgroundColor:"#fff",borderBottom:"1px solid #e0e0e0",position:"sticky",top:0,zIndex:100,paddingTop:"env(safe-area-inset-top)"},children:[(0,o.jsxs)("div",{style:{padding:"0 16px",display:"flex",justifyContent:"space-between",alignItems:"center",height:56},children:[(0,o.jsx)(l.default,{href:"/",style:{textDecoration:"none",display:"flex",alignItems:"center",gap:8},children:(0,o.jsx)("img",{src:"/icon-192.png",alt:"Food Tracker",width:36,height:36,style:{borderRadius:8}})}),(0,o.jsx)("button",{onClick:()=>m(!g),style:{padding:8,border:"none",background:"none",fontSize:24,cursor:"pointer",lineHeight:1},"aria-label":g?"Fechar menu":"Abrir menu",children:g?"✕":"☰"})]}),g&&(0,o.jsxs)("div",{style:{borderTop:"1px solid #e0e0e0",backgroundColor:"#fff",padding:"8px 0"},children:[d.map(e=>(0,o.jsxs)(l.default,{href:e.href,onClick:()=>m(!1),style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",textDecoration:"none",color:p===e.href?"#2196F3":"#333",backgroundColor:p===e.href?"#E3F2FD":"transparent",fontWeight:p===e.href?600:400,fontSize:16},children:[(0,o.jsx)("span",{style:{fontSize:20},children:e.icon}),e.label]},e.href)),(0,o.jsx)("div",{style:{borderTop:"1px solid #e0e0e0",margin:"8px 0"}}),(0,o.jsxs)("button",{onClick:w,style:{width:"100%",display:"flex",alignItems:"center",gap:12,padding:"12px 16px",border:"none",backgroundColor:"transparent",textAlign:"left",cursor:"pointer",fontSize:16,color:"#c62828"},children:[(0,o.jsx)("span",{style:{fontSize:20}}),"Sair"]})]})]}),(0,o.jsx)("main",{children:t})]})}var f=n(68398);function p(e){try{let t=e.split(".");if(3!==t.length)return null;let n=t[1],o=atob(n.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(o)}catch(e){return null}}async function g(e){console.log("[RevenueCat] initializeRevenueCat called with userId:",e);let t=Date.now();try{let l="appl_OiPDVxuiDMQziBsdvPSKUEnoquI";if(console.log("[RevenueCat] API key exists:",!!l),!l){console.warn("[RevenueCat] API key not configured");return}let{Purchases:s}=await n.e(938).then(n.bind(n,31938));console.log("[RevenueCat] Purchases module imported"),console.log("[RevenueCat] Calling configure..."),await s.configure({apiKey:l,appUserID:e}),console.log("[RevenueCat] configure completed in",Date.now()-t,"ms");try{console.log("[RevenueCat] Calling logIn..."),await s.logIn({appUserID:e}),console.log("[RevenueCat] logIn completed")}catch(e){console.log("[RevenueCat] logIn skipped or failed:",(null==e?void 0:e.message)||e)}try{var o,a,r,i;console.log("[RevenueCat] Testing getOfferings after init...");let e=await s.getOfferings();console.log("[RevenueCat] Offerings test result:",JSON.stringify({hasCurrent:!!(null==e?void 0:e.current),currentId:null==e?void 0:null===(o=e.current)||void 0===o?void 0:o.identifier,packagesCount:null!==(i=null==e?void 0:null===(r=e.current)||void 0===r?void 0:null===(a=r.availablePackages)||void 0===a?void 0:a.length)&&void 0!==i?i:0}))}catch(e){console.error("[RevenueCat] Offerings test FAILED:",(null==e?void 0:e.message)||e)}console.log("[RevenueCat] Initialized successfully with userId:",e,"total time:",Date.now()-t,"ms")}catch(e){console.error("[RevenueCat] Init error:",(null==e?void 0:e.message)||e),console.error("[RevenueCat] Init error details:",JSON.stringify({message:null==e?void 0:e.message,code:null==e?void 0:e.code,stack:null==e?void 0:e.stack}))}}function m(e){let{children:t}=e,n=(0,r.useRouter)(),i=(0,r.usePathname)(),l=["/login","/signup"],[s,c]=(0,a.useState)(()=>{let e=window.location.pathname||"";return l.some(t=>e.startsWith(t))}),[u,d]=(0,a.useState)(null),m=(0,a.useRef)(null);return((0,a.useEffect)(()=>{let e=l.some(e=>null==i?void 0:i.startsWith(e)),t=localStorage.getItem("auth_token");if(d(t),e){c(!0),(0,f.sc)();return}if(!t){c(!1),(0,f.sc)(),n.replace("/login");try{setTimeout(()=>{try{{let e=window.location.pathname||"";l.some(t=>e.startsWith(t))||window.location.replace("/login.html")}}catch(e){}},1500)}catch(e){}return}if(c(!0),m.current!==t){m.current=t;let e=p(t),n=null==e?void 0:e.userId;n&&g(n),(0,f.tJ)()}},[n,i]),(0,a.useEffect)(()=>{if(l.some(e=>null==i?void 0:i.startsWith(e))){(0,f.sc)();return}let e=localStorage.getItem("auth_token");if(!e){(0,f.sc)();return}let t=p(e);"free"===((null==t?void 0:t.plan)||"free")?(0,f.Ob)():(0,f.sc)()},[u,i]),(0,a.useEffect)(()=>{let e=e=>{if("auth_token"===e.key||"auth_logout_at"===e.key){let e=localStorage.getItem("auth_token");d(e),e||(c(!1),(0,f.sc)(),m.current=null,n.replace("/login"))}},t=()=>{let e=localStorage.getItem("auth_token");d(e),e||(c(!1),(0,f.sc)(),m.current=null,n.replace("/login"))};return window.addEventListener("storage",e),window.addEventListener("app:logout",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("app:logout",t)}},[n]),s)?l.some(e=>null==i?void 0:i.startsWith(e))?(0,o.jsx)("div",{style:{paddingTop:"env(safe-area-inset-top)"},children:t}):(0,o.jsx)(h,{tenantName:"Food Tracker",userName:"Voc\xea",children:t}):(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",paddingTop:"env(safe-area-inset-top)",flexDirection:"column",gap:12},children:[(0,o.jsx)("div",{children:"Carregando..."}),(0,o.jsx)("a",{href:"/login.html",style:{color:"#2196F3",textDecoration:"underline"},children:"Ir para a tela de login"})]})}},86394:function(e,t,n){"use strict";n.d(t,{R:function(){return c}});var o=n(2265),a=n(87185),r=n(45591);async function i(){let e=await r.h.get("/api/user/profile");if(!e.ok)throw Error("Failed to fetch user plan: ".concat(e.status));let t=(await e.json()).user;return{plan:t.plan||"free",subscription_status:t.subscription_status||"active",subscription_started_at:t.subscription_started_at,subscription_expires_at:t.subscription_expires_at}}async function l(){let e=await r.h.get("/api/subscription/quota");if(!e.ok)throw Error("Failed to fetch quota usage: ".concat(e.status));return e.json()}async function s(){try{var e;console.log("[useUserPlan] Starting RevenueCat sync...");let{Purchases:t}=await n.e(938).then(n.bind(n,31938)),{customerInfo:o}=await t.getCustomerInfo();console.log("[useUserPlan] CustomerInfo received:",JSON.stringify({originalAppUserId:o.originalAppUserId,activeSubscriptions:o.activeSubscriptions,hasActiveEntitlements:Object.keys((null===(e=o.entitlements)||void 0===e?void 0:e.active)||{}).length>0}));let a=await r.h.post("/api/subscription/sync",{customerInfo:o});console.log("[useUserPlan] Sync response:",JSON.stringify(a))}catch(e){console.warn("[useUserPlan] Sync error:",(null==e?void 0:e.message)||e)}}function c(){let[e,t]=(0,o.useState)("free"),[n,r]=(0,o.useState)("active"),[c,u]=(0,o.useState)(null),[d,h]=(0,o.useState)(!0),[f,p]=(0,o.useState)(null),g=(0,o.useRef)(!1),m=async()=>{try{h(!0),p(null),a.dV.isNativePlatform()&&!g.current&&(g.current=!0,await s());let e=await i();if(t(e.plan),r(e.subscription_status),"premium"===e.plan){let e=await l(),t=function(e){var t;let n=e.photo_analyses/e.limits.photo_analyses_per_month*100,o=e.ocr_analyses/e.limits.ocr_analyses_per_month*100,a=e.text_analyses/e.limits.text_analyses_per_month*100,r=null===(t=e.limits)||void 0===t?void 0:t.report_analyses_per_month,i=e.report_analyses,l=new Date,s=new Date(l.getFullYear(),l.getMonth()+1,1);return{photo_analyses:{used:e.photo_analyses,limit:e.limits.photo_analyses_per_month,percentage:Math.round(n),remaining:e.limits.photo_analyses_per_month-e.photo_analyses},ocr_analyses:{used:e.ocr_analyses,limit:e.limits.ocr_analyses_per_month,percentage:Math.round(o),remaining:e.limits.ocr_analyses_per_month-e.ocr_analyses},text_analyses:{used:e.text_analyses,limit:e.limits.text_analyses_per_month,percentage:Math.round(a),remaining:e.limits.text_analyses_per_month-e.text_analyses},report_analyses:void 0!==r?{used:i||0,limit:r,percentage:Math.round(r?(i||0)/r*100:0),remaining:r-(i||0)}:void 0,resetDate:s}}(e);u(t)}else u(null)}catch(e){console.error("Error fetching user plan:",e),p(e instanceof Error?e:Error("Unknown error")),t("free"),u(null)}finally{h(!1)}};return(0,o.useEffect)(()=>{m()},[]),{plan:e,subscription_status:n,quota:c,isLoading:d,error:f,refetch:m}}},68398:function(e,t,n){"use strict";n.d(t,{Ob:function(){return p},sc:function(){return g},showRewardedAd:function(){return m},tJ:function(){return f}});var o=n(87185);let a="ca-app-pub-1018925088575422/1014553329",r="ca-app-pub-1018925088575422/2438303871",i=null,l=null,s=null,c=!1,u=!1;async function d(){if(!i)try{let e=await n.e(124).then(n.bind(n,97124));i=e.AdMob||null,l=e.BannerAdSize||null,s=e.BannerAdPosition||null}catch(e){console.warn("[AdMob] Community plugin not available:",e),i=null}}async function h(){if(o.dV.isNativePlatform()&&!u&&(u=!0,await d(),i))try{if("function"==typeof i.requestTrackingAuthorization){console.log("[ATT] Requesting tracking authorization...");let e=await i.requestTrackingAuthorization();console.log("[ATT] Authorization result:",e)}else console.log("[ATT] requestTrackingAuthorization not available (possibly Android or older iOS)")}catch(e){console.warn("[ATT] requestTrackingAuthorization error (non-fatal):",e)}}async function f(){if(o.dV.isNativePlatform()&&!c){if(await h(),await d(),!i){c=!0;return}try{"function"==typeof i.initialize&&await i.initialize({})}catch(e){console.warn("[AdMob] init error (non-fatal):",e)}finally{c=!0}}}async function p(){if(!o.dV.isNativePlatform()){console.log("[AdMob] showTopBanner: not native platform, skipping");return}if(await f(),!i){console.warn("[AdMob] showTopBanner: admob not loaded");return}try{console.log("[AdMob] showTopBanner: calling showBanner with id:",a),await i.showBanner({adId:a,adSize:null==l?void 0:l.ADAPTIVE_BANNER,position:null==s?void 0:s.TOP_CENTER,margin:0}),console.log("[AdMob] showTopBanner: success")}catch(e){console.warn("[AdMob] showTopBanner failed:",e)}}async function g(){if(o.dV.isNativePlatform()&&(await f(),i))try{await i.removeBanner()}catch(e){console.warn("[AdMob] hideTopBanner failed:",e)}}async function m(e){if(!o.dV.isNativePlatform())return console.log("[AdMob] Not native, simulating rewarded ad for dev"),!0;if(await f(),!i)return console.warn("[AdMob] showRewardedAd: admob not loaded, allowing action"),!0;try{return console.log("[AdMob] showRewardedAd: preparing with id:",r),await i.prepareRewardVideoAd({adId:r}),console.log("[AdMob] showRewardedAd: showing..."),await i.showRewardVideoAd(),console.log("[AdMob] showRewardedAd: completed successfully"),!0}catch(e){return console.warn("[AdMob] showRewardedAd failed:",e),!1}}},45591:function(e,t,n){"use strict";n.d(t,{h:function(){return i},x:function(){return r}});var o=n(45800);let a=n(20357).env.NEXT_PUBLIC_API_URL||"https://app.foodtracker.com.br";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{token:n,timeoutMs:r,...i}=t,l={...i.headers};if(n)l.Authorization="Bearer ".concat(n);else{let e=localStorage.getItem("auth_token");console.log("[API Client] localStorage auth_token:",e?"exists":"null"),e&&(l.Authorization="Bearer ".concat(e))}i.body&&"string"==typeof i.body&&!l["Content-Type"]&&(l["Content-Type"]="application/json");let s=e.startsWith("http")?e:"".concat(a).concat(e);console.log("[API Client]",{isMobile:!0,baseUrl:a,endpoint:e,finalUrl:s,hasAuthToken:!!l.Authorization,allHeaders:Object.keys(l),xAdCompleted:l["x-ad-completed"]||"not set"});try{var c;let t=i.signal?null:new AbortController,n=null!==(c=null==t?void 0:t.signal)&&void 0!==c?c:i.signal,a=null;t&&(a=setTimeout(()=>{try{t.abort()}catch(e){}},"number"==typeof r?r:1e4));let u=await fetch(s,{...i,headers:l,credentials:"include",signal:n});if(a&&clearTimeout(a),console.log("[API Client] Response ".concat(e,":"),{status:u.status}),401===u.status){console.warn("401 Unauthorized - triggering client logout");try{(0,o.h)()}catch(e){}}if(404===u.status)try{let e=u.clone(),t=await e.json().catch(()=>null),n=(null==t?void 0:t.error)||"";if("string"==typeof n&&n.toLowerCase().includes("tenant")){console.warn("404 tenant_not_found - triggering client logout");try{(0,o.h)()}catch(e){}}}catch(e){}return u}catch(e){if((null==e?void 0:e.name)==="AbortError")throw console.error("[API Client Error] Timeout"),Error("Tempo de rede esgotado");throw console.error("[API Client Error]",e),e}}let i={get:(e,t)=>r(e,{method:"GET",token:t}),post:(e,t,n)=>r(e,{method:"POST",body:JSON.stringify(t),token:n}),put:(e,t,n)=>r(e,{method:"PUT",body:JSON.stringify(t),token:n}),patch:(e,t,n)=>r(e,{method:"PATCH",body:JSON.stringify(t),token:n}),delete:(e,t)=>r(e,{method:"DELETE",token:t})}},45800:function(e,t,n){"use strict";function o(){try{try{localStorage.removeItem("auth_token")}catch(e){}try{localStorage.setItem("auth_logout_at",String(Date.now()))}catch(e){}try{window.dispatchEvent(new Event("app:logout"))}catch(e){}}catch(e){}}n.d(t,{h:function(){return o}})},58877:function(){},76830:function(e){e.exports={style:{fontFamily:"'__Poppins_51684b', '__Poppins_Fallback_51684b'",fontStyle:"normal"},className:"__className_51684b"}}},function(e){e.O(0,[5,325,353,138,971,23,744],function(){return e(e.s=65695)}),_N_E=e.O()}]);