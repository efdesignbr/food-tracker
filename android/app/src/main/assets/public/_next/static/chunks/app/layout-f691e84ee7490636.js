(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185,398],{65695:function(e,t,n){Promise.resolve().then(n.bind(n,47847)),Promise.resolve().then(n.t.bind(n,76830,23)),Promise.resolve().then(n.t.bind(n,58877,23))},47847:function(e,t,n){"use strict";n.d(t,{default:function(){return y}});var o=n(57437),a=n(2265),r=n(16463),i=n(98174),s=n(87138),l=n(14799),c=n(86394),u=n(45800),d=n(87185);let p=[{href:"/",label:"In\xedcio",icon:""},{href:"/capture",label:"Capturar",icon:""},{href:"/history",label:"Hist\xf3rico",icon:""},{href:"/peso",label:"Peso",icon:""},{href:"/lista-compras",label:"Lista de Compras",icon:""},{href:"/coach",label:"Coach IA",icon:""},{href:"/reports",label:"Relat\xf3rios",icon:""},{href:"/restaurants",label:"Restaurantes",icon:""},{href:"/meus-alimentos",label:"Meus Alimentos",icon:""},{href:"/account",label:"Minha Conta",icon:""}];function f(e){let{children:t,tenantName:n,userName:f}=e,h=(0,r.useRouter)(),g=(0,r.usePathname)(),[m,y]=(0,a.useState)(!1),{plan:b,isLoading:_}=(0,c.R)();async function w(){if(localStorage.getItem("auth_token"))try{(0,u.h)()}catch(e){}try{await (0,i.w7)({redirect:!1})}catch(e){console.error("SignOut error:",e)}h.push("/login"),h.refresh()}let[x,v]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{v(d.dV.isNativePlatform())},[]),(0,o.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5"},children:[x&&(0,o.jsx)("div",{style:{height:60,background:"transparent"}}),(0,o.jsxs)("header",{style:{backgroundColor:"#fff",borderBottom:"1px solid #e0e0e0",position:"sticky",top:0,zIndex:100,paddingTop:"env(safe-area-inset-top)"},children:[(0,o.jsxs)("div",{style:{padding:"0 16px",display:"flex",justifyContent:"space-between",alignItems:"center",height:56},children:[(0,o.jsxs)(s.default,{href:"/",style:{textDecoration:"none",display:"flex",alignItems:"center",gap:8},children:[(0,o.jsx)("img",{src:"/icon-192.png",alt:"Food Tracker",width:36,height:36,style:{borderRadius:8}}),!_&&(0,o.jsx)(l.Z,{plan:b,size:"sm"})]}),(0,o.jsx)("button",{onClick:()=>y(!m),style:{padding:8,border:"none",background:"none",fontSize:24,cursor:"pointer",lineHeight:1},"aria-label":m?"Fechar menu":"Abrir menu",children:m?"✕":"☰"})]}),m&&(0,o.jsxs)("div",{style:{borderTop:"1px solid #e0e0e0",backgroundColor:"#fff",padding:"8px 0"},children:[p.map(e=>(0,o.jsxs)(s.default,{href:e.href,onClick:()=>y(!1),style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",textDecoration:"none",color:g===e.href?"#2196F3":"#333",backgroundColor:g===e.href?"#E3F2FD":"transparent",fontWeight:g===e.href?600:400,fontSize:16},children:[(0,o.jsx)("span",{style:{fontSize:20},children:e.icon}),e.label]},e.href)),(0,o.jsx)("div",{style:{borderTop:"1px solid #e0e0e0",margin:"8px 0"}}),(0,o.jsxs)("button",{onClick:w,style:{width:"100%",display:"flex",alignItems:"center",gap:12,padding:"12px 16px",border:"none",backgroundColor:"transparent",textAlign:"left",cursor:"pointer",fontSize:16,color:"#c62828"},children:[(0,o.jsx)("span",{style:{fontSize:20}}),"Sair"]})]})]}),(0,o.jsx)("main",{children:t})]})}var h=n(68398);function g(e){try{let t=e.split(".");if(3!==t.length)return null;let n=t[1],o=atob(n.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(o)}catch(e){return null}}async function m(e){try{let t="appl_OiPDVxuiDMQziBsdvPSKUEnoquI";if(!t){console.warn("[RevenueCat] API key not configured");return}let{Purchases:o}=await n.e(938).then(n.bind(n,31938));await o.configure({apiKey:t,appUserID:e});try{await o.logIn({appUserID:e})}catch(e){console.log("[RevenueCat] logIn skipped or failed:",e)}console.log("[RevenueCat] Initialized with userId:",e)}catch(e){console.error("[RevenueCat] Init error:",e)}}function y(e){let{children:t}=e,n=(0,r.useRouter)(),i=(0,r.usePathname)(),[s,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),d=(0,a.useRef)(null);return((0,a.useEffect)(()=>{let e=["/login","/signup"].some(e=>null==i?void 0:i.startsWith(e)),t=localStorage.getItem("auth_token");if(u(t),e){l(!0),(0,h.sc)();return}if(!t){l(!1),(0,h.sc)(),n.replace("/login");return}if(l(!0),d.current!==t){d.current=t;let e=g(t),n=null==e?void 0:e.userId;n&&m(n),(0,h.tJ)()}},[n,i]),(0,a.useEffect)(()=>{if(["/login","/signup"].some(e=>null==i?void 0:i.startsWith(e))){(0,h.sc)();return}let e=localStorage.getItem("auth_token");if(!e){(0,h.sc)();return}let t=g(e);"free"===((null==t?void 0:t.plan)||"free")?(0,h.Ob)():(0,h.sc)()},[c,i]),(0,a.useEffect)(()=>{let e=e=>{if("auth_token"===e.key||"auth_logout_at"===e.key){let e=localStorage.getItem("auth_token");u(e),e||(l(!1),(0,h.sc)(),d.current=null,n.replace("/login"))}},t=()=>{let e=localStorage.getItem("auth_token");u(e),e||(l(!1),(0,h.sc)(),d.current=null,n.replace("/login"))};return window.addEventListener("storage",e),window.addEventListener("app:logout",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("app:logout",t)}},[n]),s)?["/login","/signup"].some(e=>null==i?void 0:i.startsWith(e))?(0,o.jsx)("div",{style:{paddingTop:"env(safe-area-inset-top)"},children:t}):(0,o.jsx)(f,{tenantName:"Food Tracker",userName:"Voc\xea",children:t}):(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",paddingTop:"env(safe-area-inset-top)"},children:"Carregando..."})}},14799:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var o=n(57437);let a={free:{label:"FREE",emoji:"",bg:"linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)",text:"#6b7280",border:"#d1d5db"},premium:{label:"Premium",emoji:"",bg:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",text:"#ffffff",border:"#667eea"},unlimited:{label:"Unlimited",emoji:"",bg:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",text:"#ffffff",border:"#f093fb"}},r={sm:{fontSize:10,padding:"2px 6px",gap:3},md:{fontSize:12,padding:"4px 8px",gap:4},lg:{fontSize:14,padding:"6px 12px",gap:6}};function i(e){let{plan:t,size:n="md"}=e,i=a[t],s=r[n];return(0,o.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:s.gap,padding:s.padding,borderRadius:6,background:i.bg,color:i.text,fontSize:s.fontSize,fontWeight:700,letterSpacing:"0.5px",border:"1px solid ".concat(i.border),textTransform:"uppercase",lineHeight:1,whiteSpace:"nowrap"},children:[i.emoji&&(0,o.jsx)("span",{children:i.emoji}),i.label]})}},86394:function(e,t,n){"use strict";n.d(t,{R:function(){return c}});var o=n(2265),a=n(87185),r=n(45591);async function i(){let e=await r.h.get("/api/user/profile");if(!e.ok)throw Error("Failed to fetch user plan: ".concat(e.status));let t=(await e.json()).user;return{plan:t.plan||"free",subscription_status:t.subscription_status||"active",subscription_started_at:t.subscription_started_at,subscription_expires_at:t.subscription_expires_at}}async function s(){let e=await r.h.get("/api/subscription/quota");if(!e.ok)throw Error("Failed to fetch quota usage: ".concat(e.status));return e.json()}async function l(){try{let{Purchases:e}=await n.e(938).then(n.bind(n,31938)),{customerInfo:t}=await e.getCustomerInfo();await r.h.post("/api/subscription/sync",{customerInfo:t}),console.log("[useUserPlan] Sync success")}catch(e){console.warn("[useUserPlan] Sync error:",e)}}function c(){let[e,t]=(0,o.useState)("free"),[n,r]=(0,o.useState)("active"),[c,u]=(0,o.useState)(null),[d,p]=(0,o.useState)(!0),[f,h]=(0,o.useState)(null),g=(0,o.useRef)(!1),m=async()=>{try{p(!0),h(null),a.dV.isNativePlatform()&&!g.current&&(g.current=!0,await l());let e=await i();if(t(e.plan),r(e.subscription_status),"premium"===e.plan){let e=await s(),t=function(e){var t;let n=e.photo_analyses/e.limits.photo_analyses_per_month*100,o=e.ocr_analyses/e.limits.ocr_analyses_per_month*100,a=e.text_analyses/e.limits.text_analyses_per_month*100,r=null===(t=e.limits)||void 0===t?void 0:t.report_analyses_per_month,i=e.report_analyses,s=new Date,l=new Date(s.getFullYear(),s.getMonth()+1,1);return{photo_analyses:{used:e.photo_analyses,limit:e.limits.photo_analyses_per_month,percentage:Math.round(n),remaining:e.limits.photo_analyses_per_month-e.photo_analyses},ocr_analyses:{used:e.ocr_analyses,limit:e.limits.ocr_analyses_per_month,percentage:Math.round(o),remaining:e.limits.ocr_analyses_per_month-e.ocr_analyses},text_analyses:{used:e.text_analyses,limit:e.limits.text_analyses_per_month,percentage:Math.round(a),remaining:e.limits.text_analyses_per_month-e.text_analyses},report_analyses:void 0!==r?{used:i||0,limit:r,percentage:Math.round(r?(i||0)/r*100:0),remaining:r-(i||0)}:void 0,resetDate:l}}(e);u(t)}else u(null)}catch(e){console.error("Error fetching user plan:",e),h(e instanceof Error?e:Error("Unknown error")),t("free"),u(null)}finally{p(!1)}};return(0,o.useEffect)(()=>{m()},[]),{plan:e,subscription_status:n,quota:c,isLoading:d,error:f,refetch:m}}},68398:function(e,t,n){"use strict";n.d(t,{Ob:function(){return p},sc:function(){return f},showRewardedAd:function(){return h},tJ:function(){return d}});var o=n(87185);let a="ca-app-pub-1018925088575422/1014553329",r="ca-app-pub-1018925088575422/2438303871",i=null,s=null,l=null,c=!1;async function u(){if(!i)try{let e=await n.e(124).then(n.bind(n,97124));i=e.AdMob||null,s=e.BannerAdSize||null,l=e.BannerAdPosition||null}catch(e){console.warn("[AdMob] Community plugin not available:",e),i=null}}async function d(){if(o.dV.isNativePlatform()&&!c){if(await u(),!i){c=!0;return}try{"function"==typeof i.initialize&&await i.initialize({})}catch(e){console.warn("[AdMob] init error (non-fatal):",e)}finally{c=!0}}}async function p(){if(!o.dV.isNativePlatform()){console.log("[AdMob] showTopBanner: not native platform, skipping");return}if(await d(),!i){console.warn("[AdMob] showTopBanner: admob not loaded");return}try{console.log("[AdMob] showTopBanner: calling showBanner with id:",a),await i.showBanner({adId:a,adSize:null==s?void 0:s.ADAPTIVE_BANNER,position:null==l?void 0:l.TOP_CENTER,margin:0}),console.log("[AdMob] showTopBanner: success")}catch(e){console.warn("[AdMob] showTopBanner failed:",e)}}async function f(){if(o.dV.isNativePlatform()&&(await d(),i))try{await i.removeBanner()}catch(e){console.warn("[AdMob] hideTopBanner failed:",e)}}async function h(e){if(!o.dV.isNativePlatform())return console.log("[AdMob] Not native, simulating rewarded ad for dev"),!0;if(await d(),!i)return console.warn("[AdMob] showRewardedAd: admob not loaded, allowing action"),!0;try{return console.log("[AdMob] showRewardedAd: preparing with id:",r),await i.prepareRewardVideoAd({adId:r}),console.log("[AdMob] showRewardedAd: showing..."),await i.showRewardVideoAd(),console.log("[AdMob] showRewardedAd: completed successfully"),!0}catch(e){return console.warn("[AdMob] showRewardedAd failed:",e),!1}}},45591:function(e,t,n){"use strict";n.d(t,{h:function(){return i},x:function(){return r}});var o=n(45800);let a=n(20357).env.NEXT_PUBLIC_API_URL||"https://app.foodtracker.com.br";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{token:n,...r}=t,i={...r.headers};if(n)i.Authorization="Bearer ".concat(n);else{let e=localStorage.getItem("auth_token");console.log("[API Client] localStorage auth_token:",e?"exists":"null"),e&&(i.Authorization="Bearer ".concat(e))}r.body&&"string"==typeof r.body&&!i["Content-Type"]&&(i["Content-Type"]="application/json");let s=e.startsWith("http")?e:"".concat(a).concat(e);console.log("[API Client]",{isMobile:!0,baseUrl:a,endpoint:e,finalUrl:s,hasAuthToken:!!i.Authorization,allHeaders:Object.keys(i),xAdCompleted:i["x-ad-completed"]||"not set"});try{let t=await fetch(s,{...r,headers:i,credentials:"include"});if(console.log("[API Client] Response ".concat(e,":"),{status:t.status}),401===t.status){console.warn("401 Unauthorized - triggering client logout");try{(0,o.h)()}catch(e){}}return t}catch(e){throw console.error("[API Client Error]",e),e}}let i={get:(e,t)=>r(e,{method:"GET",token:t}),post:(e,t,n)=>r(e,{method:"POST",body:JSON.stringify(t),token:n}),put:(e,t,n)=>r(e,{method:"PUT",body:JSON.stringify(t),token:n}),patch:(e,t,n)=>r(e,{method:"PATCH",body:JSON.stringify(t),token:n}),delete:(e,t)=>r(e,{method:"DELETE",token:t})}},45800:function(e,t,n){"use strict";function o(){try{try{localStorage.removeItem("auth_token")}catch(e){}try{localStorage.setItem("auth_logout_at",String(Date.now()))}catch(e){}try{window.dispatchEvent(new Event("app:logout"))}catch(e){}}catch(e){}}n.d(t,{h:function(){return o}})},58877:function(){},76830:function(e){e.exports={style:{fontFamily:"'__Poppins_51684b', '__Poppins_Fallback_51684b'",fontStyle:"normal"},className:"__className_51684b"}}},function(e){e.O(0,[5,325,353,138,971,23,744],function(){return e(e.s=65695)}),_N_E=e.O()}]);