"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[78],{14799:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(57437);let o={free:{label:"FREE",emoji:"",bg:"linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)",text:"#6b7280",border:"#d1d5db"},premium:{label:"Premium",emoji:"",bg:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",text:"#ffffff",border:"#667eea"},unlimited:{label:"Unlimited",emoji:"",bg:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",text:"#ffffff",border:"#f093fb"}},i={sm:{fontSize:10,padding:"2px 6px",gap:3},md:{fontSize:12,padding:"4px 8px",gap:4},lg:{fontSize:14,padding:"6px 12px",gap:6}};function a(e){let{plan:t,size:n="md"}=e,a=o[t],s=i[n];return(0,r.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:s.gap,padding:s.padding,borderRadius:6,background:a.bg,color:a.text,fontSize:s.fontSize,fontWeight:700,letterSpacing:"0.5px",border:"1px solid ".concat(a.border),textTransform:"uppercase",lineHeight:1,whiteSpace:"nowrap"},children:[a.emoji&&(0,r.jsx)("span",{children:a.emoji}),a.label]})}},46285:function(e,t,n){n.d(t,{x5:function(){return d},lQ:function(){return b},vE:function(){return r.Z},Lw:function(){return g},Yz:function(){return l}});var r=n(14799),o=n(57437),i=n(16463);let a={primary:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#ffffff",border:"none",boxShadow:"0 2px 8px rgba(102, 126, 234, 0.3)"},secondary:{background:"#f3f4f6",color:"#667eea",border:"1px solid #e5e7eb",boxShadow:"none"},outline:{background:"transparent",color:"#667eea",border:"1px solid #667eea",boxShadow:"none"}},s={sm:{fontSize:12,padding:"6px 12px",borderRadius:6},md:{fontSize:14,padding:"8px 16px",borderRadius:8},lg:{fontSize:16,padding:"12px 24px",borderRadius:10}};function l(e){let{variant:t="primary",size:n="md",currentPlan:r}=e,l=(0,i.useRouter)();if("unlimited"===r)return null;let c=a[t],d=s[n],u="free"===r?"/upgrade":"/subscription";return(0,o.jsxs)("button",{onClick:()=>{l.push(u)},style:{...c,...d,fontWeight:600,cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=c.boxShadow},children:["free"===r&&" ","free"===r?"Fazer Upgrade":"Gerenciar Assinatura"]})}let c={photo_analysis:{title:"An\xe1lise de Foto",icon:"",description:"A an\xe1lise de fotos de refei\xe7\xf5es \xe9 exclusiva para usu\xe1rios PREMIUM",benefits:["90 an\xe1lises de foto por m\xeas","IA avan\xe7ada para reconhecer alimentos","C\xe1lculo autom\xe1tico de macros","Hist\xf3rico ilimitado"]},ocr_analysis:{title:"An\xe1lise de Tabelas Nutricionais",icon:"",description:"A leitura de tabelas nutricionais \xe9 exclusiva para usu\xe1rios PREMIUM",benefits:["30 an\xe1lises de tabelas por m\xeas","OCR preciso de r\xf3tulos","Importa\xe7\xe3o r\xe1pida de alimentos","Hist\xf3rico ilimitado"]},coach_analysis:{title:"Coach IA",icon:"",description:"O Coach IA com insights personalizados \xe9 exclusivo para usu\xe1rios PREMIUM",benefits:["An\xe1lises ilimitadas do seu progresso","Insights baseados em peso, medidas e alimenta\xe7\xe3o","Recomenda\xe7\xf5es personalizadas","Alertas importantes sobre sua sa\xfade"]}};function d(e){let{isOpen:t,onClose:n,feature:r,currentPlan:a}=e,s=(0,i.useRouter)(),l=c[r];return t?(0,o.jsx)("div",{onClick:e=>{e.target===e.currentTarget&&n()},style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:16},children:(0,o.jsxs)("div",{style:{backgroundColor:"#fff",borderRadius:16,padding:32,maxWidth:480,width:"100%",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",position:"relative"},children:[(0,o.jsx)("button",{onClick:n,style:{position:"absolute",top:16,right:16,border:"none",background:"none",fontSize:24,cursor:"pointer",color:"#666",lineHeight:1,padding:4},"aria-label":"Fechar"}),(0,o.jsx)("div",{style:{fontSize:48,textAlign:"center",marginBottom:16},children:l.icon}),(0,o.jsx)("h2",{style:{fontSize:24,fontWeight:700,textAlign:"center",margin:"0 0 8px 0",color:"#1a1a1a"},children:"Recurso Premium"}),(0,o.jsx)("p",{style:{fontSize:16,color:"#666",textAlign:"center",margin:"0 0 24px 0",lineHeight:1.5},children:l.description}),(0,o.jsx)("div",{style:{height:1,backgroundColor:"#e5e7eb",margin:"24px 0"}}),(0,o.jsx)("h3",{style:{fontSize:18,fontWeight:600,margin:"0 0 16px 0",color:"#1a1a1a"},children:"Com PREMIUM voc\xea tem:"}),(0,o.jsx)("ul",{style:{listStyle:"none",padding:0,margin:"0 0 24px 0"},children:l.benefits.map((e,t)=>(0,o.jsxs)("li",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0",fontSize:15,color:"#333"},children:[(0,o.jsx)("span",{style:{color:"#10b981",fontSize:20}}),e]},t))}),(0,o.jsxs)("div",{style:{display:"flex",gap:12,marginTop:24},children:[(0,o.jsx)("button",{onClick:n,style:{flex:1,padding:"12px 24px",borderRadius:8,border:"1px solid #e5e7eb",backgroundColor:"#fff",color:"#666",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f9fafb"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#fff"},children:"Fechar"}),(0,o.jsx)("button",{onClick:()=>{s.push("/upgrade")},style:{flex:1,padding:"12px 24px",borderRadius:8,border:"none",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#fff",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.3)"},children:"Ver Planos"})]})]})}):null}let u={photo:{title:"An\xe1lise de Fotos",icon:"",unit:"an\xe1lises"},ocr:{title:"An\xe1lise de Tabelas",icon:"",unit:"an\xe1lises"},text:{title:"An\xe1lise de Texto",icon:"",unit:"an\xe1lises"},report:{title:"Relat\xf3rios IA",icon:"",unit:"an\xe1lises"}};function p(e){return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}).format(e)}function g(e){let{quotaType:t,used:n,limit:r,percentage:i,remaining:a,resetDate:s}=e,l=u[t],c=i<=50?"#10b981":i<=80?"#f59e0b":"#ef4444";return(0,o.jsxs)("div",{style:{background:"white",border:"2px solid #e5e7eb",borderRadius:12,padding:20,marginBottom:16},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12},children:[(0,o.jsx)("span",{style:{fontSize:24},children:l.icon}),(0,o.jsx)("h3",{style:{fontSize:16,fontWeight:700,margin:0,color:"#1a1a1a"},children:l.title})]}),(0,o.jsxs)("div",{style:{fontSize:14,color:"#666",marginBottom:8},children:[(0,o.jsxs)("span",{style:{fontWeight:600,color:c},children:[n,"/",r]})," ","usadas (",i,"%)"]}),(0,o.jsx)("div",{style:{width:"100%",height:8,backgroundColor:"#f3f4f6",borderRadius:4,overflow:"hidden",marginBottom:12},children:(0,o.jsx)("div",{style:{width:"".concat(Math.min(i,100),"%"),height:"100%",backgroundColor:c,transition:"width 0.3s ease, background-color 0.3s ease"}})}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,color:"#6b7280"},children:[(0,o.jsx)("div",{children:(0,o.jsx)("strong",{style:{color:a>0?c:"#dc2626"},children:a>0?"Restam: ".concat(a):"Limite atingido"})}),(0,o.jsxs)("div",{children:["Renova em: ",(0,o.jsx)("strong",{children:p(s)})]})]}),i>=80&&a>0&&(0,o.jsx)("div",{style:{marginTop:12,padding:8,background:i>=90?"#fee2e2":"#fef3c7",border:"1px solid ".concat(i>=90?"#fca5a5":"#fcd34d"),borderRadius:6,fontSize:12,color:i>=90?"#991b1b":"#92400e"},children:i>=90?" Voc\xea est\xe1 quase no limite! Restam apenas ".concat(a," ").concat(l.unit,"."):" Aten\xe7\xe3o: voc\xea j\xe1 usou ".concat(i,"% da sua quota este m\xeas.")}),0===a&&(0,o.jsxs)("div",{style:{marginTop:12,padding:10,background:"#fee2e2",border:"2px solid #ef4444",borderRadius:6,fontSize:13,color:"#991b1b",fontWeight:600},children:["Limite mensal atingido. Sua quota ser\xe1 renovada em ",p(s),"."]})]})}var f=n(2265),h=n(87185),m=n(45591);function b(e){let{onPurchaseComplete:t,onClose:r}=e,{isLoading:i,error:a,packages:s,isMobile:l,loadOfferings:c,purchase:d,restorePurchases:u}=function(){let[e,t]=(0,f.useState)({isLoading:!1,error:null,offerings:null,packages:[]}),r=h.dV.isNativePlatform(),o=(0,f.useCallback)(async()=>{if(!r){t(e=>({...e,error:"Compras dispon\xedveis apenas no app"}));return}try{t(e=>({...e,isLoading:!0,error:null}));let{Purchases:e}=await n.e(938).then(n.bind(n,31938)),r=(await e.getOfferings()).current;if(!r){t(e=>({...e,isLoading:!1,error:"Assinaturas temporariamente indispon\xedveis. Tente novamente mais tarde."}));return}t({isLoading:!1,error:null,offerings:r,packages:r.availablePackages||[]})}catch(e){console.error("[Purchase] Load offerings error:",e),t(e=>({...e,isLoading:!1,error:"Assinaturas temporariamente indispon\xedveis. Tente novamente mais tarde."}))}},[r]),i=(0,f.useCallback)(async e=>{if(!r)return!1;try{t(e=>({...e,isLoading:!0,error:null}));let{Purchases:r}=await n.e(938).then(n.bind(n,31938)),o=await r.purchasePackage({aPackage:e}),i=!!o.customerInfo.entitlements.active.premium;if(t(e=>({...e,isLoading:!1})),i)try{await m.h.post("/api/subscription/sync",{customerInfo:o.customerInfo}),console.log("[Purchase] Sync success")}catch(e){console.error("[Purchase] Sync error:",e)}return i}catch(e){if(null==e?void 0:e.userCancelled)return t(e=>({...e,isLoading:!1})),!1;return console.error("[Purchase] Error:",e),t(e=>({...e,isLoading:!1,error:"N\xe3o foi poss\xedvel completar a compra. Tente novamente."})),!1}},[r]),a=(0,f.useCallback)(async()=>{if(!r)return!1;try{t(e=>({...e,isLoading:!0,error:null}));let{Purchases:e}=await n.e(938).then(n.bind(n,31938)),{customerInfo:r}=await e.restorePurchases(),o=!!r.entitlements.active.premium;if(t(e=>({...e,isLoading:!1})),o)try{await m.h.post("/api/subscription/sync",{customerInfo:r}),console.log("[Purchase] Restore sync success")}catch(e){console.error("[Purchase] Sync error:",e)}return o}catch(e){return console.error("[Purchase] Restore error:",e),t(e=>({...e,isLoading:!1,error:"N\xe3o foi poss\xedvel restaurar compras. Tente novamente."})),!1}},[r]);return{...e,isMobile:r,loadOfferings:o,purchase:i,restorePurchases:a}}();(0,f.useEffect)(()=>{c()},[c]);let p=async e=>{await d(e)&&(null==t||t())},g=async()=>{await u()&&(null==t||t())};return l?i&&0===s.length?(0,o.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,o.jsx)("div",{style:{width:32,height:32,border:"3px solid #e5e7eb",borderTopColor:"#667eea",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),(0,o.jsx)("p",{style:{color:"#666"},children:"Carregando planos..."}),(0,o.jsx)("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):a?(0,o.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,o.jsx)("p",{style:{color:"#dc2626",marginBottom:16},children:a}),(0,o.jsx)("button",{onClick:c,style:{padding:"10px 20px",background:"#667eea",color:"white",border:"none",borderRadius:8,cursor:"pointer"},children:"Tentar novamente"})]}):(0,o.jsxs)("div",{style:{padding:16},children:[(0,o.jsx)("div",{style:{display:"grid",gap:16},children:s.map(e=>{let t=e.product,n="ANNUAL"===e.packageType;return(0,o.jsxs)("div",{style:{border:n?"2px solid #667eea":"2px solid #e5e7eb",borderRadius:16,padding:20,position:"relative",background:n?"linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%)":"white"},children:[n&&(0,o.jsx)("div",{style:{position:"absolute",top:-12,right:16,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"4px 12px",borderRadius:12,fontSize:12,fontWeight:700},children:"MELHOR OFERTA"}),(0,o.jsx)("h3",{style:{fontSize:18,fontWeight:700,margin:"0 0 8px 0",color:"#1a1a1a"},children:n?"Plano Anual":"Plano Mensal"}),(0,o.jsxs)("div",{style:{marginBottom:12},children:[(0,o.jsx)("span",{style:{fontSize:28,fontWeight:800,color:"#667eea"},children:t.priceString}),(0,o.jsx)("span",{style:{color:"#666",fontSize:14},children:n?"/ano":"/m\xeas"})]}),n&&(0,o.jsx)("p",{style:{fontSize:13,color:"#059669",marginBottom:12},children:"Economia de 66% comparado ao mensal"}),(0,o.jsx)("button",{onClick:()=>p(e),disabled:i,style:{width:"100%",padding:14,borderRadius:12,border:"none",background:i?"#e5e7eb":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:i?"#9ca3af":"white",fontSize:16,fontWeight:700,cursor:i?"not-allowed":"pointer"},children:i?"Processando...":"Assinar"})]},e.identifier)})}),(0,o.jsx)("div",{style:{marginTop:24,textAlign:"center"},children:(0,o.jsx)("button",{onClick:g,disabled:i,style:{background:"none",border:"none",color:"#667eea",fontSize:14,cursor:"pointer",textDecoration:"underline"},children:"Restaurar compra anterior"})}),r&&(0,o.jsx)("div",{style:{marginTop:16,textAlign:"center"},children:(0,o.jsx)("button",{onClick:r,style:{background:"none",border:"none",color:"#666",fontSize:14,cursor:"pointer"},children:"Fechar"})})]}):(0,o.jsx)("div",{style:{padding:24,textAlign:"center"},children:(0,o.jsx)("p",{style:{color:"#666"},children:"Assinaturas dispon\xedveis apenas no aplicativo."})})}},86394:function(e,t,n){n.d(t,{R:function(){return c}});var r=n(2265),o=n(87185),i=n(45591);async function a(){let e=await i.h.get("/api/user/profile");if(!e.ok)throw Error("Failed to fetch user plan: ".concat(e.status));let t=(await e.json()).user;return{plan:t.plan||"free",subscription_status:t.subscription_status||"active",subscription_started_at:t.subscription_started_at,subscription_expires_at:t.subscription_expires_at}}async function s(){let e=await i.h.get("/api/subscription/quota");if(!e.ok)throw Error("Failed to fetch quota usage: ".concat(e.status));return e.json()}async function l(){try{let{Purchases:e}=await n.e(938).then(n.bind(n,31938)),{customerInfo:t}=await e.getCustomerInfo();await i.h.post("/api/subscription/sync",{customerInfo:t}),console.log("[useUserPlan] Sync success")}catch(e){console.warn("[useUserPlan] Sync error:",e)}}function c(){let[e,t]=(0,r.useState)("free"),[n,i]=(0,r.useState)("active"),[c,d]=(0,r.useState)(null),[u,p]=(0,r.useState)(!0),[g,f]=(0,r.useState)(null),h=(0,r.useRef)(!1),m=async()=>{try{p(!0),f(null),o.dV.isNativePlatform()&&!h.current&&(h.current=!0,await l());let e=await a();if(t(e.plan),i(e.subscription_status),"premium"===e.plan){let e=await s(),t=function(e){var t;let n=e.photo_analyses/e.limits.photo_analyses_per_month*100,r=e.ocr_analyses/e.limits.ocr_analyses_per_month*100,o=e.text_analyses/e.limits.text_analyses_per_month*100,i=null===(t=e.limits)||void 0===t?void 0:t.report_analyses_per_month,a=e.report_analyses,s=new Date,l=new Date(s.getFullYear(),s.getMonth()+1,1);return{photo_analyses:{used:e.photo_analyses,limit:e.limits.photo_analyses_per_month,percentage:Math.round(n),remaining:e.limits.photo_analyses_per_month-e.photo_analyses},ocr_analyses:{used:e.ocr_analyses,limit:e.limits.ocr_analyses_per_month,percentage:Math.round(r),remaining:e.limits.ocr_analyses_per_month-e.ocr_analyses},text_analyses:{used:e.text_analyses,limit:e.limits.text_analyses_per_month,percentage:Math.round(o),remaining:e.limits.text_analyses_per_month-e.text_analyses},report_analyses:void 0!==i?{used:a||0,limit:i,percentage:Math.round(i?(a||0)/i*100:0),remaining:i-(a||0)}:void 0,resetDate:l}}(e);d(t)}else d(null)}catch(e){console.error("Error fetching user plan:",e),f(e instanceof Error?e:Error("Unknown error")),t("free"),d(null)}finally{p(!1)}};return(0,r.useEffect)(()=>{m()},[]),{plan:e,subscription_status:n,quota:c,isLoading:u,error:g,refetch:m}}},45591:function(e,t,n){n.d(t,{h:function(){return a},x:function(){return i}});var r=n(45800);let o=n(20357).env.NEXT_PUBLIC_API_URL||"https://app.foodtracker.com.br";async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{token:n,...i}=t,a={...i.headers};if(n)a.Authorization="Bearer ".concat(n);else{let e=localStorage.getItem("auth_token");console.log("[API Client] localStorage auth_token:",e?"exists":"null"),e&&(a.Authorization="Bearer ".concat(e))}i.body&&"string"==typeof i.body&&!a["Content-Type"]&&(a["Content-Type"]="application/json");let s=e.startsWith("http")?e:"".concat(o).concat(e);console.log("[API Client]",{isMobile:!0,baseUrl:o,endpoint:e,finalUrl:s,hasAuthToken:!!a.Authorization,allHeaders:Object.keys(a),xAdCompleted:a["x-ad-completed"]||"not set"});try{let t=await fetch(s,{...i,headers:a,credentials:"include"});if(console.log("[API Client] Response ".concat(e,":"),{status:t.status}),401===t.status){console.warn("401 Unauthorized - triggering client logout");try{(0,r.h)()}catch(e){}}return t}catch(e){throw console.error("[API Client Error]",e),e}}let a={get:(e,t)=>i(e,{method:"GET",token:t}),post:(e,t,n)=>i(e,{method:"POST",body:JSON.stringify(t),token:n}),put:(e,t,n)=>i(e,{method:"PUT",body:JSON.stringify(t),token:n}),patch:(e,t,n)=>i(e,{method:"PATCH",body:JSON.stringify(t),token:n}),delete:(e,t)=>i(e,{method:"DELETE",token:t})}},45800:function(e,t,n){n.d(t,{h:function(){return r}});function r(){try{try{localStorage.removeItem("auth_token")}catch(e){}try{localStorage.setItem("auth_logout_at",String(Date.now()))}catch(e){}try{window.dispatchEvent(new Event("app:logout"))}catch(e){}}catch(e){}}}}]);