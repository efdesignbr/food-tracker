(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[790,398],{77372:function(e,o,t){Promise.resolve().then(t.bind(t,97581))},97581:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return c}});var n=t(57437),r=t(2265),i=t(86394),a=t(95682),l=t(34648),d=t(45591),s=t(45224);function u(){try{let e=new Intl.DateTimeFormat("sv-SE",{timeZone:"America/Sao_Paulo",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(new Date),o=o=>{var t;return(null===(t=e.find(e=>e.type===o))||void 0===t?void 0:t.value)||""};return"".concat(o("year"),"-").concat(o("month"),"-").concat(o("day"),"T").concat(o("hour"),":").concat(o("minute"))}catch(t){let e=new Date,o=e=>String(e).padStart(2,"0");return"".concat(e.getFullYear(),"-").concat(o(e.getMonth()+1),"-").concat(o(e.getDate()),"T").concat(o(e.getHours()),":").concat(o(e.getMinutes()))}}function c(){var e,o;let{plan:t,quota:c,isLoading:g}=(0,i.R)(),{hasQuota:p}=(0,a.f)(t,c),[h,f]=(0,r.useState)(!1),[b,m]=(0,r.useState)(null),[x,y]=(0,r.useState)(null),[v,w]=(0,r.useState)(!1),[j,S]=(0,r.useState)(""),[k,_]=(0,r.useState)(null),[A,z]=(0,r.useState)(()=>u()),[R,C]=(0,r.useState)(""),[B,T]=(0,r.useState)(null),[E,W]=(0,r.useState)(!1),[N,M]=(0,r.useState)("home"),[q,P]=(0,r.useState)(""),[I,F]=(0,r.useState)([]),[O,D]=(0,r.useState)(!1),[L,G]=(0,r.useState)(null),[U,V]=(0,r.useState)([]),[J,H]=(0,r.useState)(!1),[Q,Y]=(0,r.useState)(!1),[K,Z]=(0,r.useState)(""),[X,$]=(0,r.useState)([]),[ee,eo]=(0,r.useState)(!1),[et,en]=(0,r.useState)("");async function er(e){return new Promise((o,t)=>{let n=new FileReader;n.readAsDataURL(e),n.onload=n=>{var r;let i=new Image;i.src=null===(r=n.target)||void 0===r?void 0:r.result,i.onload=()=>{let n=document.createElement("canvas"),r=i.width,a=i.height;r>a&&r>1024?(a=1024*a/r,r=1024):a>1024&&(r=1024*r/a,a=1024),n.width=r,n.height=a;let l=n.getContext("2d");null==l||l.drawImage(i,0,0,r,a);let d=.8,s=()=>{n.toBlob(n=>{if(!n){t(Error("Erro ao comprimir imagem"));return}n.size<512e3||d<.3?o(new File([n],e.name,{type:"image/jpeg",lastModified:Date.now()})):(d-=.1,s())},"image/jpeg",d)};s()},i.onerror=()=>t(Error("Erro ao carregar imagem"))},n.onerror=()=>t(Error("Erro ao ler arquivo"))})}async function ei(e){var o;let t=null===(o=e.target.files)||void 0===o?void 0:o[0];if(t){w(!0),T(null);try{let e=await er(t);m(e),y(URL.createObjectURL(e))}catch(e){T("Erro ao processar imagem. Tente outra foto.")}finally{w(!1)}}}async function ea(e){if(e.trim().length<2){$([]);return}try{eo(!0);let o=await d.h.get("/api/food-bank?q=".concat(encodeURIComponent(e))),t=await o.json();o.ok&&$(t.items||[])}catch(e){console.error("Erro ao buscar alimentos:",e)}finally{eo(!1)}}async function el(e){var o,t,n,r,i,a,l;let s=prompt('Quantas unidades de "'.concat(e.name,'"?'),"1");if(!s)return;let u=Number(s);if(isNaN(u)||u<=0){alert("Quantidade inv\xe1lida! Digite um n\xfamero maior que zero.");return}try{await d.h.post("/api/food-bank/increment-usage",{id:e.id})}catch(e){console.error("Erro ao incrementar uso:",e)}let c=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=Math.pow(10,o);return Math.round(e*t)/t};V([...U,{name:e.name,quantity:u,unit:e.serving_size||"por\xe7\xe3o",calories:Math.round((null!==(o=e.calories)&&void 0!==o?o:0)*u),protein_g:c((null!==(t=e.protein)&&void 0!==t?t:0)*u),carbs_g:c((null!==(n=e.carbs)&&void 0!==n?n:0)*u),fat_g:c((null!==(r=e.fat)&&void 0!==r?r:0)*u),fiber_g:c((null!==(i=e.fiber)&&void 0!==i?i:0)*u),sodium_mg:Math.round((null!==(a=e.sodium)&&void 0!==a?a:0)*u),sugar_g:c((null!==(l=e.sugar)&&void 0!==l?l:0)*u),source:"bank"}]),Z(""),$([]),H(!1)}function ed(){if(!et.trim()){alert("Digite o nome do alimento!");return}V([...U,{name:et.trim(),quantity:1,unit:"por\xe7\xe3o",source:"new"}]),en(""),Y(!1)}async function es(){if(!b){T("Selecione uma foto para analisar!");return}w(!0),T(null);try{let e=await b.arrayBuffer(),o=new Blob([e],{type:b.type||"image/jpeg"}),t=b.name||"image.jpg",n=JSON.stringify({location_type:N,restaurant_name:"out"===N?null==L?void 0:L.name:void 0}),r=()=>{let e=new FormData;return e.append("image",o,t),e.append("context",n),e},i=await (0,s.q)(e=>(0,d.x)("/api/meals/analyze-image",{method:"POST",body:r(),headers:e}),{feature:"photo_analysis"}),a=await i.json();if(!i.ok){let e=(0,s.p)(i,a);if(e)throw Error(e);if(499===i.status||503===i.status&&(null==a?void 0:a.error)==="ad_failed")return;if(403===i.status&&(null==a?void 0:a.error)==="upgrade_required"){f(!0);return}throw Error(a.error||"Erro ao analisar foto")}_(a.result)}catch(e){T(e instanceof Error?e.message:"Erro ao analisar foto")}finally{w(!1)}}async function eu(){if(0===U.length){T("Adicione pelo menos um alimento para analisar!");return}w(!0),T(null);try{let e;let o={foods:U.map(e=>({name:e.name,quantity:e.quantity,unit:e.unit,calories:e.calories,protein_g:e.protein_g,carbs_g:e.carbs_g,fat_g:e.fat_g,fiber_g:e.fiber_g,sodium_mg:e.sodium_mg,sugar_g:e.sugar_g})),location_type:N,restaurant_name:"out"===N?null==L?void 0:L.name:void 0};if(b){let t=await b.arrayBuffer(),n=new Blob([t],{type:b.type||"image/jpeg"}),r=b.name||"image.jpg",i=JSON.stringify(o),a=()=>{let e=new FormData;return e.append("image",n,r),e.append("data",i),e};e=await (0,s.q)(e=>(0,d.x)("/api/meals/analyze-meal",{method:"POST",body:a(),headers:e}),{feature:"photo_analysis"})}else e=await (0,s.q)(e=>(0,d.x)("/api/meals/analyze-meal",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json",...e||{}}}),{feature:"text_analysis"});let t=await e.json();if(!e.ok){let o=(0,s.p)(e,t);if(o)throw Error(o);if(499===e.status||503===e.status&&(null==t?void 0:t.error)==="ad_failed")return;if(403===e.status&&(null==t?void 0:t.error)==="upgrade_required"){f(!0);return}throw Error(t.error||"Erro ao analisar")}_(t.result)}catch(e){T(e.message)}finally{w(!1)}}async function ec(){if(k){if(!j){T("Por favor, selecione o tipo de refei\xe7\xe3o");return}w(!0),T(null),W(!1);try{let e;let o={meal_type:j,consumed_at:A+":00-03:00",notes:R||k.notes||"",foods:(k.foods||[]).map(e=>({name:e.name,quantity:Number(e.quantity)||1,unit:e.unit||"un",calories:e.calories,protein_g:e.protein_g,carbs_g:e.carbs_g,fat_g:e.fat_g,fiber_g:e.fiber_g,sodium_mg:e.sodium_mg,sugar_g:e.sugar_g}))};if(o.location_type=N,"out"===N){if(!(null==L?void 0:L.id))throw Error("Selecione um restaurante para refei\xe7\xf5es fora de casa");o.restaurant_id=L.id}else o.restaurant_id=null;if(b){let t=new FormData;t.append("image",b),t.append("payload",JSON.stringify(o)),e=await (0,d.x)("/api/meals/approve",{method:"POST",body:t})}else e=await d.h.post("/api/meals/approve",o);let t=await e.json();if(!e.ok)throw Error(t.error||"Erro ao salvar");W(!0),m(null),y(null),V([]),_(null),C(""),z(u()),M("home"),G(null),P(""),F([])}catch(e){T(e.message)}finally{w(!1)}}}let eg=(null==k?void 0:null===(e=k.foods)||void 0===e?void 0:e.reduce((e,o)=>e+(o.calories||0),0))||0;return(0,n.jsxs)("div",{style:{maxWidth:800,margin:"0 auto",padding:24},children:[(0,n.jsx)("h1",{style:{fontSize:28,fontWeight:700,marginBottom:24},children:"Capturar Refei\xe7\xe3o"}),(0,n.jsx)(l.x5,{isOpen:h,onClose:()=>f(!1),feature:"photo_analysis",currentPlan:t}),p&&c&&(0,n.jsx)(l.Lw,{quotaType:"photo",used:c.photo_analyses.used,limit:c.photo_analyses.limit,percentage:c.photo_analyses.percentage,remaining:c.photo_analyses.remaining,resetDate:c.resetDate}),(0,n.jsx)("div",{style:{border:"2px dashed #d1d5db",borderRadius:16,padding:24,textAlign:"center",background:"#f9fafb",marginBottom:24,position:"relative"},children:x?(0,n.jsxs)("div",{children:[(0,n.jsx)("img",{src:x,alt:"Preview",style:{maxWidth:"100%",maxHeight:200,borderRadius:12,marginBottom:12}}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"center",flexWrap:"wrap"},children:[(0,n.jsx)("button",{onClick:()=>{m(null),y(null)},style:{padding:"8px 16px",background:"#ef4444",color:"white",border:"none",borderRadius:8,cursor:"pointer"},children:"Remover Foto"}),!k&&(0,n.jsx)("button",{onClick:es,disabled:v,style:{padding:"8px 16px",background:v?"#9ca3af":"#8b5cf6",color:"white",border:"none",borderRadius:8,cursor:v?"not-allowed":"pointer",fontWeight:600},children:v?"Analisando...":"Analisar Foto com IA"})]})]}):(0,n.jsxs)("label",{style:{cursor:"pointer"},children:[(0,n.jsx)("div",{style:{fontSize:40,marginBottom:8,color:"#2196F3"},children:"Foto"}),(0,n.jsx)("div",{style:{fontSize:14,color:"#666",marginBottom:12},children:"Adicionar foto da refei\xe7\xe3o (opcional)"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:ei,style:{display:"none"}}),(0,n.jsx)("div",{style:{display:"inline-block",padding:"10px 20px",background:"#2196F3",color:"white",borderRadius:8,fontWeight:600,fontSize:14},children:"Selecionar Foto"})]})}),!k&&(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:24},children:[(0,n.jsx)("button",{onClick:()=>H(!0),style:{padding:16,background:"#10b981",color:"white",border:"none",borderRadius:12,fontSize:16,fontWeight:600,cursor:"pointer"},children:"Meus Alimentos"}),(0,n.jsx)("button",{onClick:()=>Y(!0),style:{padding:16,background:"#3b82f6",color:"white",border:"none",borderRadius:12,fontSize:16,fontWeight:600,cursor:"pointer"},children:"Adicionar Novo"})]}),!k&&U.length>0&&(0,n.jsxs)("div",{style:{background:"#f0fdf4",border:"2px solid #10b981",borderRadius:16,padding:24,marginBottom:24},children:[(0,n.jsxs)("h3",{style:{fontSize:18,fontWeight:600,marginBottom:16,color:"#065f46"},children:["Alimentos Adicionados (",U.length,")"]}),(0,n.jsx)("div",{style:{display:"grid",gap:12,marginBottom:16},children:U.map((e,o)=>(0,n.jsxs)("div",{style:{padding:12,background:"white",borderRadius:8,border:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:600},children:e.name}),(0,n.jsxs)("div",{style:{fontSize:12,color:"#6b7280"},children:[e.quantity," ",e.unit,"bank"===e.source&&(0,n.jsx)("span",{children:" • Do banco"}),"new"===e.source&&(0,n.jsx)("span",{children:" • Novo"})]})]}),(0,n.jsx)("button",{onClick:()=>(function(e){let o=[...U];o.splice(e,1),V(o)})(o),style:{padding:"6px",background:"#fee2e2",color:"#dc2626",border:"none",borderRadius:6,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Remover",children:(0,n.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14M10 11v6M14 11v6"})})})]},o))}),(0,n.jsx)("button",{onClick:eu,disabled:v,style:{width:"100%",padding:16,background:v?"#9ca3af":"#8b5cf6",color:"white",border:"none",borderRadius:12,fontSize:16,fontWeight:600,cursor:v?"not-allowed":"pointer"},children:v?"Analisando com IA...":"Analisar com IA"})]}),B&&(0,n.jsx)("div",{style:{padding:16,background:"#fee2e2",border:"2px solid #ef4444",borderRadius:12,color:"#991b1b",marginBottom:24},children:B}),E&&(0,n.jsx)("div",{style:{padding:16,background:"#d1fae5",border:"2px solid #10b981",borderRadius:12,color:"#065f46",marginBottom:24},children:"Refei\xe7\xe3o salva com sucesso!"}),k&&(0,n.jsxs)("div",{style:{marginBottom:32},children:[(0,n.jsxs)("div",{style:{background:"white",border:"2px solid #e5e7eb",borderRadius:16,padding:24,marginBottom:24},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,n.jsx)("h2",{style:{fontSize:20,fontWeight:700},children:"An\xe1lise da Refei\xe7\xe3o"}),(0,n.jsxs)("div",{style:{padding:"8px 16px",background:"#dbeafe",color:"#1e40af",borderRadius:20,fontWeight:600},children:[eg," kcal"]})]}),k.notes&&(0,n.jsx)("p",{style:{color:"#666",fontSize:14,marginBottom:16,fontStyle:"italic"},children:k.notes}),(0,n.jsx)("div",{style:{display:"grid",gap:12},children:null===(o=k.foods)||void 0===o?void 0:o.map((e,o)=>(0,n.jsxs)("div",{style:{padding:16,background:"#f9fafb",borderRadius:12,border:"1px solid #e5e7eb"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12,alignItems:"center"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("span",{style:{fontWeight:600,fontSize:16},children:e.name}),"taco"===e.source&&(0,n.jsx)("span",{style:{fontSize:10,padding:"2px 6px",background:"#10b981",color:"white",borderRadius:4,fontWeight:600},children:"TACO"}),"bank"===e.source&&(0,n.jsx)("span",{style:{fontSize:10,padding:"2px 6px",background:"#3b82f6",color:"white",borderRadius:4,fontWeight:600},children:"MEUS ALIMENTOS"}),!e.source&&(0,n.jsx)("span",{style:{fontSize:10,padding:"2px 6px",background:"#f59e0b",color:"white",borderRadius:4,fontWeight:600},children:"IA"})]}),(0,n.jsxs)("span",{style:{color:"#666"},children:[e.quantity," ",e.unit]})]}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:8},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{fontSize:12,color:"#666",display:"block",marginBottom:4},children:"Calorias (kcal)"}),(0,n.jsx)("input",{type:"number",value:e.calories||"",onChange:e=>{let t=[...k.foods];t[o].calories=Number(e.target.value)||void 0,_({...k,foods:t})},style:{width:"100%",padding:"6px 8px",fontSize:14,border:"1px solid #d1d5db",borderRadius:6,outline:"none",boxSizing:"border-box"},placeholder:"0"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{fontSize:12,color:"#666",display:"block",marginBottom:4},children:"Prote\xedna (g)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:e.protein_g||"",onChange:e=>{let t=[...k.foods];t[o].protein_g=Number(e.target.value)||void 0,_({...k,foods:t})},style:{width:"100%",padding:"6px 8px",fontSize:14,border:"1px solid #d1d5db",borderRadius:6,outline:"none",boxSizing:"border-box"},placeholder:"0"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{fontSize:12,color:"#666",display:"block",marginBottom:4},children:"Carboidrato (g)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:e.carbs_g||"",onChange:e=>{let t=[...k.foods];t[o].carbs_g=Number(e.target.value)||void 0,_({...k,foods:t})},style:{width:"100%",padding:"6px 8px",fontSize:14,border:"1px solid #d1d5db",borderRadius:6,outline:"none",boxSizing:"border-box"},placeholder:"0"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{fontSize:12,color:"#666",display:"block",marginBottom:4},children:"Gordura (g)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:e.fat_g||"",onChange:e=>{let t=[...k.foods];t[o].fat_g=Number(e.target.value)||void 0,_({...k,foods:t})},style:{width:"100%",padding:"6px 8px",fontSize:14,border:"1px solid #d1d5db",borderRadius:6,outline:"none",boxSizing:"border-box"},placeholder:"0"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{fontSize:12,color:"#666",display:"block",marginBottom:4},children:"Fibras (g)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:e.fiber_g||"",onChange:e=>{let t=[...k.foods];t[o].fiber_g=Number(e.target.value)||void 0,_({...k,foods:t})},style:{width:"100%",padding:"6px 8px",fontSize:14,border:"1px solid #d1d5db",borderRadius:6,outline:"none",boxSizing:"border-box"},placeholder:"0"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{fontSize:12,color:"#666",display:"block",marginBottom:4},children:"S\xf3dio (mg)"}),(0,n.jsx)("input",{type:"number",step:"1",value:e.sodium_mg||"",onChange:e=>{let t=[...k.foods];t[o].sodium_mg=Number(e.target.value)||void 0,_({...k,foods:t})},style:{width:"100%",padding:"6px 8px",fontSize:14,border:"1px solid #d1d5db",borderRadius:6,outline:"none",boxSizing:"border-box"},placeholder:"0"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{fontSize:12,color:"#666",display:"block",marginBottom:4},children:"A\xe7\xfacar (g)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:e.sugar_g||"",onChange:e=>{let t=[...k.foods];t[o].sugar_g=Number(e.target.value)||void 0,_({...k,foods:t})},style:{width:"100%",padding:"6px 8px",fontSize:14,border:"1px solid #d1d5db",borderRadius:6,outline:"none",boxSizing:"border-box"},placeholder:"0"})]})]})]},o))})]}),(0,n.jsxs)("div",{style:{display:"grid",gap:16},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:8,fontWeight:600},children:"Tipo de Refei\xe7\xe3o *"}),(0,n.jsxs)("select",{value:j,onChange:e=>S(e.target.value),style:{width:"100%",padding:12,fontSize:16,border:j?"2px solid #e5e7eb":"2px solid #ef4444",borderRadius:8,backgroundColor:"white",boxSizing:"border-box"},children:[(0,n.jsx)("option",{value:"",children:"Selecione o tipo..."}),(0,n.jsx)("option",{value:"breakfast",children:"Caf\xe9 da Manh\xe3"}),(0,n.jsx)("option",{value:"lunch",children:"Almo\xe7o"}),(0,n.jsx)("option",{value:"dinner",children:"Jantar"}),(0,n.jsx)("option",{value:"snack",children:"Lanche"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:8,fontWeight:600},children:"Quando foi consumido?"}),(0,n.jsx)("input",{type:"datetime-local",value:A,onChange:e=>z(e.target.value),style:{width:"100%",padding:12,fontSize:16,border:"2px solid #e5e7eb",borderRadius:8,boxSizing:"border-box"}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:8,fontWeight:600},children:"Observa\xe7\xf5es (opcional)"}),(0,n.jsx)("input",{type:"text",value:R,onChange:e=>C(e.target.value),placeholder:"Ex: Comi tudo, estava delicioso!",style:{width:"100%",padding:12,fontSize:16,border:"2px solid #e5e7eb",borderRadius:8,boxSizing:"border-box"}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:8,fontWeight:600},children:"Local da Refei\xe7\xe3o"}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:8},children:[(0,n.jsx)("button",{type:"button",onClick:()=>{M("home"),G(null)},style:{flex:1,padding:10,borderRadius:8,border:"home"===N?"2px solid #10b981":"2px solid #e5e7eb",background:"home"===N?"#ecfdf5":"white",fontWeight:600,color:"home"===N?"#065f46":"#374151"},children:"Casa"}),(0,n.jsx)("button",{type:"button",onClick:()=>M("out"),style:{flex:1,padding:10,borderRadius:8,border:"out"===N?"2px solid #f59e0b":"2px solid #e5e7eb",background:"out"===N?"#fffbeb":"white",fontWeight:600,color:"out"===N?"#92400e":"#374151"},children:"Fora"})]}),"out"===N&&(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:6,fontWeight:500,color:"#92400e"},children:"Restaurante (obrigat\xf3rio)"}),(0,n.jsx)("input",{type:"text",value:q,onChange:async e=>{let o=e.target.value;if(P(o),L&&G(null),o.trim().length<2){F([]);return}try{D(!0);let e=await d.h.get("/api/restaurants/search?q=".concat(encodeURIComponent(o))),t=await e.json();e.ok&&F(t.restaurants||[])}finally{D(!1)}},placeholder:"Digite o nome do restaurante...",style:{width:"100%",padding:12,fontSize:16,border:"2px solid #fbbf24",borderRadius:L?"8px":"8px 8px 0 0",outline:"none",boxSizing:"border-box"}}),!L&&(O||I.length>0||q.trim().length>=2&&0===I.length)&&(0,n.jsxs)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"white",border:"1px solid #e5e7eb",borderTop:"none",borderRadius:"0 0 8px 8px",maxHeight:200,overflowY:"auto",zIndex:10},children:[O&&(0,n.jsx)("div",{style:{padding:10,fontSize:14,color:"#6b7280"},children:"Carregando..."}),!O&&I.map(e=>(0,n.jsxs)("button",{type:"button",onClick:()=>{G({id:e.id,name:e.name}),P(e.name),F([])},style:{width:"100%",textAlign:"left",padding:"10px 12px",border:"none",background:"white",cursor:"pointer",borderBottom:"1px solid #f3f4f6"},children:[(0,n.jsx)("div",{style:{fontWeight:600},children:e.name}),e.address&&(0,n.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:e.address})]},e.id)),!O&&0===I.length&&q.trim().length>=2&&(0,n.jsxs)("div",{style:{padding:10},children:[(0,n.jsx)("div",{style:{fontSize:14,color:"#6b7280",marginBottom:8},children:"Nenhum restaurante encontrado."}),(0,n.jsxs)("button",{type:"button",onClick:async()=>{if(q.trim()&&confirm('Cadastrar o restaurante "'.concat(q.trim(),'"?')))try{D(!0);let e=await d.h.post("/api/restaurants",{name:q.trim()}),o=await e.json();if(e.ok){let e=o.restaurant.name;G({id:o.restaurant.id,name:e}),P(e),F([])}else alert(o.error||"Erro ao cadastrar restaurante")}catch(e){alert("Erro ao cadastrar restaurante: "+e.message)}finally{D(!1)}},style:{width:"100%",padding:"10px 12px",background:"#10b981",color:"white",border:"none",borderRadius:6,fontWeight:700,cursor:"pointer"},children:['Cadastrar "',q.trim(),'"']})]})]}),L&&(0,n.jsxs)("div",{style:{marginTop:8,fontSize:13,color:"#92400e"},children:["Selecionado: ",(0,n.jsx)("strong",{children:L.name})]})]})]}),(0,n.jsx)("button",{onClick:ec,disabled:v,style:{width:"100%",padding:16,background:"#2196F3",color:"white",border:"none",borderRadius:12,fontSize:16,fontWeight:600,cursor:v?"not-allowed":"pointer",opacity:v?.6:1},children:v?"Salvando...":"Salvar Refei\xe7\xe3o"})]})]}),J&&(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:20},children:(0,n.jsxs)("div",{style:{background:"white",borderRadius:16,padding:24,maxWidth:500,width:"100%",maxHeight:"80vh",overflowY:"auto"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,n.jsx)("h2",{style:{fontSize:20,fontWeight:700},children:"Meus Alimentos"}),(0,n.jsx)("button",{onClick:()=>{H(!1),Z(""),$([])},style:{padding:8,background:"#f3f4f6",border:"none",borderRadius:8,cursor:"pointer",color:"#6b7280",display:"flex",alignItems:"center",justifyContent:"center"},title:"Fechar",children:(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),(0,n.jsx)("input",{type:"text",value:K,onChange:e=>{Z(e.target.value),ea(e.target.value)},placeholder:"Buscar alimento...",style:{width:"100%",padding:12,fontSize:16,border:"2px solid #10b981",borderRadius:8,outline:"none",marginBottom:16,boxSizing:"border-box"}}),ee&&(0,n.jsx)("div",{style:{textAlign:"center",color:"#6b7280"},children:"Buscando..."}),!ee&&X.length>0&&(0,n.jsx)("div",{style:{display:"grid",gap:8},children:X.map(e=>(0,n.jsxs)("button",{onClick:()=>el(e),style:{width:"100%",textAlign:"left",padding:12,background:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:8,cursor:"pointer"},children:[(0,n.jsxs)("div",{style:{fontWeight:600,marginBottom:4},children:[e.name,e.brand&&(0,n.jsxs)("span",{style:{color:"#6b7280",fontWeight:400},children:[" - ",e.brand]})]}),(0,n.jsxs)("div",{style:{fontSize:12,color:"#6b7280"},children:[e.serving_size&&(0,n.jsxs)("span",{children:["Por\xe7\xe3o: ",e.serving_size," | "]}),e.calories&&(0,n.jsxs)("span",{children:[e.calories," kcal"]})]})]},e.id))}),!ee&&K.length>=2&&0===X.length&&(0,n.jsxs)("div",{style:{textAlign:"center",color:"#dc2626",padding:16},children:["Nenhum alimento encontrado. ",(0,n.jsx)("a",{href:"/meus-alimentos",style:{color:"#2196F3",textDecoration:"underline"},children:"Cadastre aqui"})]})]})}),Q&&(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:20},children:(0,n.jsxs)("div",{style:{background:"white",borderRadius:16,padding:24,maxWidth:400,width:"100%"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,n.jsx)("h2",{style:{fontSize:20,fontWeight:700},children:"Adicionar Novo Alimento"}),(0,n.jsx)("button",{onClick:()=>{Y(!1),en("")},style:{padding:8,background:"#f3f4f6",border:"none",borderRadius:8,cursor:"pointer",color:"#6b7280",display:"flex",alignItems:"center",justifyContent:"center"},title:"Fechar",children:(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),(0,n.jsx)("input",{type:"text",value:et,onChange:e=>en(e.target.value),placeholder:"Ex: Bife de frango grelhado",style:{width:"100%",padding:12,fontSize:16,border:"2px solid #3b82f6",borderRadius:8,outline:"none",marginBottom:16,boxSizing:"border-box"},onKeyDown:e=>{"Enter"===e.key&&ed()},autoFocus:!0}),(0,n.jsx)("button",{onClick:ed,style:{width:"100%",padding:12,background:"#3b82f6",color:"white",border:"none",borderRadius:8,fontSize:16,fontWeight:600,cursor:"pointer"},children:"Adicionar"})]})})]})}},95682:function(e,o,t){"use strict";function n(e,o){return{canUseFeature:t=>"free"!==e&&("unlimited"===e||!!o&&("photo"===t?o.photo_analyses:"ocr"===t?o.ocr_analyses:"text"===t?o.text_analyses:o.report_analyses||{used:0,limit:0,percentage:0,remaining:0}).remaining>0),getQuotaInfo:t=>{if("free"===e)return{used:0,limit:0,remaining:0,percentage:0,canUse:!1};if("unlimited"===e){var n;return{used:o?"photo"===t?o.photo_analyses.used:"ocr"===t?o.ocr_analyses.used:"text"===t?o.text_analyses.used:(null===(n=o.report_analyses)||void 0===n?void 0:n.used)||0:0,limit:999999,remaining:999999,percentage:0,canUse:!0}}if(!o)return{used:0,limit:0,remaining:0,percentage:0,canUse:!1};let r="photo"===t?o.photo_analyses:"ocr"===t?o.ocr_analyses:"text"===t?o.text_analyses:o.report_analyses||{used:0,limit:0,percentage:0,remaining:0};return{used:r.used,limit:r.limit,remaining:r.remaining,percentage:r.percentage,canUse:r.remaining>0}},hasQuota:"premium"===e&&null!==o}}t.d(o,{f:function(){return n}})},68398:function(e,o,t){"use strict";t.d(o,{Ob:function(){return h},sc:function(){return f},showRewardedAd:function(){return b},tJ:function(){return p}});var n=t(87185);let r="ca-app-pub-1018925088575422/1014553329",i="ca-app-pub-1018925088575422/2438303871",a=null,l=null,d=null,s=!1,u=!1;async function c(){if(!a)try{let e=await t.e(124).then(t.bind(t,97124));a=e.AdMob||null,l=e.BannerAdSize||null,d=e.BannerAdPosition||null}catch(e){console.warn("[AdMob] Community plugin not available:",e),a=null}}async function g(){if(n.dV.isNativePlatform()&&!u&&(u=!0,await c(),a))try{if("function"==typeof a.requestTrackingAuthorization){console.log("[ATT] Requesting tracking authorization...");let e=await a.requestTrackingAuthorization();console.log("[ATT] Authorization result:",e)}else console.log("[ATT] requestTrackingAuthorization not available (possibly Android or older iOS)")}catch(e){console.warn("[ATT] requestTrackingAuthorization error (non-fatal):",e)}}async function p(){if(n.dV.isNativePlatform()&&!s){if(await g(),await c(),!a){s=!0;return}try{"function"==typeof a.initialize&&await a.initialize({})}catch(e){console.warn("[AdMob] init error (non-fatal):",e)}finally{s=!0}}}async function h(){if(!n.dV.isNativePlatform()){console.log("[AdMob] showTopBanner: not native platform, skipping");return}if(await p(),!a){console.warn("[AdMob] showTopBanner: admob not loaded");return}try{console.log("[AdMob] showTopBanner: calling showBanner with id:",r),await a.showBanner({adId:r,adSize:null==l?void 0:l.ADAPTIVE_BANNER,position:null==d?void 0:d.TOP_CENTER,margin:0}),console.log("[AdMob] showTopBanner: success")}catch(e){console.warn("[AdMob] showTopBanner failed:",e)}}async function f(){if(n.dV.isNativePlatform()&&(await p(),a))try{await a.removeBanner()}catch(e){console.warn("[AdMob] hideTopBanner failed:",e)}}async function b(e){if(!n.dV.isNativePlatform())return console.log("[AdMob] Not native, simulating rewarded ad for dev"),!0;if(await p(),!a)return console.warn("[AdMob] showRewardedAd: admob not loaded, allowing action"),!0;try{return console.log("[AdMob] showRewardedAd: preparing with id:",i),await a.prepareRewardVideoAd({adId:i}),console.log("[AdMob] showRewardedAd: showing..."),await a.showRewardVideoAd(),console.log("[AdMob] showRewardedAd: completed successfully"),!0}catch(e){return console.warn("[AdMob] showRewardedAd failed:",e),!1}}},45224:function(e,o,t){"use strict";t.d(o,{p:function(){return i},q:function(){return r}});var n=t(68398);async function r(e,o){console.log("[AdGuard] Starting request for feature:",null==o?void 0:o.feature);let t=await e();if(console.log("[AdGuard] First request status:",t.status),403!==t.status)return console.log("[AdGuard] Not 403, returning response"),t;try{let r=await t.clone().json().catch(()=>({}));if(console.log("[AdGuard] 403 payload:",r),(null==r?void 0:r.error)==="watch_ad_required"){if(console.log("[AdGuard] watch_ad_required detected, currentPlan:",null==r?void 0:r.currentPlan),!(null==o?void 0:o.skipConfirmation)&&!window.confirm("Este recurso requer assistir a um an\xfancio curto para continuar. Deseja prosseguir?"))return console.log("[AdGuard] User cancelled ad"),new Response(JSON.stringify({error:"ad_cancelled"}),{status:499,headers:{"Content-Type":"application/json"}});console.log("[AdGuard] Showing rewarded ad...");let t=await (0,n.showRewardedAd)(null==o?void 0:o.feature);if(console.log("[AdGuard] Ad result:",t),!t)return console.log("[AdGuard] Ad failed, returning 503"),new Response(JSON.stringify({error:"ad_failed"}),{status:503,headers:{"Content-Type":"application/json"}});console.log("[AdGuard] Ad success, retrying with x-ad-completed header");let i=await e({"x-ad-completed":"1"});return console.log("[AdGuard] Retry response status:",i.status),i}}catch(e){console.error("[AdGuard] Error:",e)}return t}function i(e,o){if(499===e.status&&(null==o?void 0:o.error)==="ad_cancelled"||503===e.status&&(null==o?void 0:o.error)==="ad_failed")return null;if(403===e.status){if((null==o?void 0:o.error)==="watch_ad_required")return"An\xfancio indispon\xedvel no momento. Tente novamente.";null==o||o.error}return null}},16463:function(e,o,t){"use strict";var n=t(71169);t.o(n,"usePathname")&&t.d(o,{usePathname:function(){return n.usePathname}}),t.o(n,"useRouter")&&t.d(o,{useRouter:function(){return n.useRouter}}),t.o(n,"useSearchParams")&&t.d(o,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[325,329,971,23,744],function(){return e(e.s=77372)}),_N_E=e.O()}]);